<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ouidoEvents - Detalii Locație</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        :root {
            --primary-color: #0052D4;
            --secondary-color: #4364F7;
            --header-bg: #ffffff;
            --dark-color: #1a202c;
            --gray-color: #555;
            --light-gray-color: #f0f2f5;
            --bg-color: #f8f9fa;
            --white-color: #ffffff;
            --border-color: #e5eaf1;
            --shadow-color: rgba(0, 82, 212, 0.1);
            --border-radius: 12px;
            --transition-base: 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; color: var(--dark-color); line-height: 1.6; background-color: var(--bg-color); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* Stiluri pentru bara de căutare */
        .main-search-section { padding: 25px 0; background-color: var(--light-gray-color); text-align: left; }

        /* Hero Section */
        .hero-section {
            padding: 30px 0;
            background-color: var(--white-color);
            border-bottom: 1px solid var(--border-color);
        }
        .breadcrumbs {
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-bottom: 15px;
        }
        .breadcrumbs a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .breadcrumbs span { margin: 0 5px; }
        .venue-name {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        .venue-name h1 { font-size: 2.1rem; }
        /* NOU: Buton Favorite */
        .favorite-btn {
            background: var(--light-gray-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .favorite-btn:hover {
            background: var(--border-color);
            transform: scale(1.1);
        }
        .favorite-btn svg {
            width: 24px;
            height: 24px;
            stroke: var(--dark-color);
            stroke-width: 2;
            fill: none;
            transition: all 0.2s ease;
        }
        .favorite-btn.is-favorite svg {
            fill: #ff4d4d;
            stroke: #ff4d4d;
        }
        .venue-address {
            color: var(--gray-color);
            font-size: 1rem;
            margin-bottom: 15px;
        }
        .venue-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        .tag { /* Re-using existing tag style */
            background-color: var(--light-gray-color);
            color: var(--gray-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .venue-description {
            font-size: 1rem;
            color: var(--gray-color);
            line-height: 1.7;
        }
        body[data-page="venue-details"] .widget-note { font-size: 0.85rem; color: var(--gray-color); text-align: center; margin-top: 15px; }
        /* Gallery Section */
        body[data-page="venue-details"] .venue-main-content {
            align-items: flex-start;
            margin-top: 30px;
        }
        body[data-page="venue-details"] .gallery-section {
            margin-bottom: 40px;
            grid-column: 1;
            grid-row: 1;
            padding: 0;
            background: none;
            border-radius: 0;
            box-shadow: none;
        }
        body[data-page="venue-details"] .gallery-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: repeat(2, 180px);
            gap: 8px;
            margin-bottom: 8px;
        }
        body[data-page="venue-details"] .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius);
            cursor: pointer;
        }
        body[data-page="venue-details"] .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        body[data-page="venue-details"] .gallery-item:hover img {
            transform: scale(1.05);
        }
        body[data-page="venue-details"] .gallery-item.main-image {
            grid-row: 1 / 3;
        }
        body[data-page="venue-details"] .thumbnail-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            height: 100px;
        }
        body[data-page="venue-details"] .last-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            transition: background 0.3s ease;
        }
        body[data-page="venue-details"] .last-image:hover::after {
            background: rgba(0,0,0,0.7);
        }
        body[data-page="venue-details"] .show-all-photos-btn {
            position: absolute;
            z-index: 2;
            bottom: 12px;
            right: 12px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--white-color);
            color: var(--white-color);
            padding: 8px 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        body[data-page="venue-details"] .show-all-photos-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        body[data-page="venue-details"] .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            padding: 10px 15px;
            z-index: 1001;
            user-select: none;
        }
        body[data-page="venue-details"] .lightbox-nav.prev {
            left: 20px;
        }
        body[data-page="venue-details"] .lightbox-nav.next {
            right: 20px;
        }

        /* Main Content Layout */
        .venue-main-content {
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(0, 1fr); /* Two columns */
            grid-auto-rows: min-content;
            gap: 40px;
            padding: 40px 0;
            align-items: flex-start;
        }
        .left-column {
            background-color: var(--white-color);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px var(--shadow-color);
            grid-column: 1;
            grid-row: 2;
        }
        .right-column {
            position: sticky;
            top: 100px; /* Adjust based on header height */
            background-color: var(--white-color);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px var(--shadow-color);
            grid-column: 2;
            grid-row: 1 / span 2;
        }

        .left-column h2, .right-column h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--dark-color);
        }
        .left-column h3 {
            font-size: 1.2rem;
            margin-top: 30px;
            margin-bottom: 15px;
            color: var(--dark-color);
        }
        .about-section p {
            font-size: 0.95rem;
            color: var(--gray-color);
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            color: var(--gray-color);
            background-color: var(--light-gray-color);
            padding: 10px 15px;
            border-radius: 8px;
        }
        .detail-item strong {
            color: var(--dark-color);
        }
        .detail-item svg {
            width: 20px;
            height: 20px;
            fill: var(--primary-color);
        }

        .facilities-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
        .facilities-list li {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--gray-color);
        }
        .facilities-list li svg {
            width: 18px;
            height: 18px;
            fill: var(--secondary-color);
        }

        /* NOU: Stil pentru lista de tipuri de evenimente */
        .event-types-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }
        .event-types-list li { background-color: var(--light-gray-color); padding: 10px 15px; border-radius: 8px; font-size: 0.9rem; color: var(--gray-color); }

        /* NOU: Sectiune Contact */
        body[data-page="venue-details"] .contact-section {
            margin-top: 30px;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-base);
        }
        body[data-page="venue-details"] .contact-section.is-visible {
            opacity: 1;
            pointer-events: auto;
        }
        .contact-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        .contact-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .contact-item svg {
            width: 24px;
            height: 24px;
            fill: var(--primary-color);
        }
        .contact-item-info span { display: block; font-size: 0.85rem; color: var(--gray-color); }
        .contact-item-info strong { display: block; font-size: 0.95rem; color: var(--dark-color); font-weight: 500; }

        .contact-section-locked {
            margin-top: 30px;
        }
        .contact-section-locked .locked-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: var(--light-gray-color);
            border: 1px dashed var(--border-color);
            padding: 20px;
            border-radius: var(--border-radius);
            color: var(--gray-color);
        }
        .contact-section-locked .locked-content svg {
            width: 40px;
            height: 40px;
            fill: var(--primary-color);
        }
        .contact-section-locked .locked-content p {
            margin: 0;
            font-size: 0.95rem;
        }
        .contact-section-locked .locked-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .contact-section-locked .locked-actions .cta-button {
            min-width: 210px;
        }

        /* Availability Widget */
        .availability-widget {
            text-align: center;
        }
        .availability-widget h3 {
            margin-bottom: 25px;
            font-size: 1.4rem;
        }
        .availability-calendar-shell { margin: 20px 0; }
        .availability-calendar { display: flex; justify-content: center; max-width: 100%; }
        .availability-calendar .flatpickr-calendar { box-shadow: 0 18px 44px -32px rgba(15, 23, 42, 0.35); border: 1px solid rgba(15, 23, 42, 0.12); border-radius: 16px; padding: 12px 16px; overflow: visible; min-width: 340px; max-width: 100%; }
        .availability-calendar .flatpickr-day { width: 37px; height: 34px; line-height: 34px; font-size: 0.8rem; }
        .availability-calendar.is-empty {
            min-height: 260px;
            border-radius: var(--border-radius);
            border: 1px dashed var(--border-color);
            background: var(--light-gray-color);
        }
        .availability-legend { display: flex; gap: 12px; justify-content: center; font-size: 0.85rem; color: var(--gray-color); margin-top: 12px; flex-wrap: wrap; }
        .availability-legend-dot { display: inline-flex; width: 12px; height: 12px; border-radius: 50%; margin-right: 6px; }
        .availability-legend-dot--available { background: #16a34a; }
        .availability-legend-dot--hold { background: #f59e0b; }
        .availability-legend-dot--booked { background: #ef4444; }
        .availability-day-hold { background: rgba(245, 158, 11, 0.15) !important; color: #92400e !important; }
        .availability-day-booked { background: rgba(239, 68, 68, 0.18) !important; color: #b91c1c !important; }
        .availability-day-available { background: rgba(22, 163, 74, 0.12) !important; color: #166534 !important; }
        .price-display {
            font-size: 1.1rem;
            color: var(--dark-color);
            margin-bottom: 20px;
        }
        .price-display strong {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        .availability-widget .cta-button {
            width: 100%;
            padding: 15px 25px;
            font-size: 1.1rem;
        }
        .cta-button.ghost {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        .cta-button.ghost:hover {
            background: rgba(0, 82, 212, 0.08);
            color: var(--primary-color);
        }
        .widget-actions { display: flex; flex-direction: column; gap: 12px; }
        .widget-actions .cta-button { width: 100%; text-align: center; }

        /* Lightbox/Modal */
        .lightbox {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 2000; /* Higher than header */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }
        .lightbox-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            border-radius: var(--border-radius);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .close-lightbox {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }
        .close-lightbox:hover,
        .close-lightbox:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* NOU: Stiluri pentru calendarul modern (Flatpickr) */
        .flatpickr-calendar {
            background: var(--white-color);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 25px var(--shadow-color);
            border: 1px solid var(--border-color);
            width: auto;
        }
        .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange,
        .flatpickr-day.selected:hover, .flatpickr-day.startRange:hover, .flatpickr-day.endRange:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }
        .flatpickr-day:hover {
            background: var(--light-gray-color);
            border-color: var(--light-gray-color);
        }
        .flatpickr-day.today { border-color: var(--secondary-color); }
        .flatpickr-day.today:hover { border-color: var(--secondary-color); background: var(--secondary-color); color: var(--white-color); }
        .flatpickr-months .flatpickr-month, .flatpickr-weekdays, .numInputWrapper, .flatpickr-current-month .flatpickr-monthDropdown-months {
            color: var(--dark-color);
            fill: var(--dark-color);
        }

        .favorites-modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.48); display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.25s ease; z-index: 1050; padding: 20px; }
        .favorites-modal-overlay.is-visible { opacity: 1; visibility: visible; }
        .favorites-modal { background: var(--white-color); border-radius: 18px; max-width: 720px; width: 100%; box-shadow: 0 25px 70px -25px rgba(15, 23, 42, 0.35); display: flex; flex-direction: column; max-height: 90vh; overflow: hidden; }
        .favorites-modal header { display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; padding: 24px 28px 16px; border-bottom: 1px solid rgba(148, 163, 184, 0.2); }
        .favorites-modal header h3 { font-size: 1.35rem; margin-bottom: 6px; }
        .favorites-modal header p { color: var(--gray-color); font-size: 0.95rem; }
        .favorites-modal-close { border: none; background: transparent; font-size: 1.8rem; line-height: 1; cursor: pointer; color: var(--gray-color); }
        .favorites-modal form { padding: 24px 28px 28px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }
        .favorites-modal .form-section { display: flex; flex-direction: column; gap: 16px; }
        .favorites-modal .panel-meta { font-size: 0.9rem; color: var(--gray-color); margin: 0; }
        .favorites-modal .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; }
        .favorites-modal label { font-weight: 600; font-size: 0.95rem; color: var(--dark-color); margin-bottom: 6px; display: inline-block; }
        .favorites-modal input,
        .favorites-modal select { width: 100%; border-radius: 10px; border: 1px solid var(--border-color); padding: 12px 14px; font-size: 0.95rem; }
        .favorites-modal footer { display: flex; justify-content: flex-end; gap: 12px; margin-top: 8px; }
        .crm-button { border-radius: 10px; border: none; cursor: pointer; font-weight: 600; font-size: 0.95rem; padding: 12px 20px; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .crm-button.primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: var(--white-color); box-shadow: 0 16px 30px -20px rgba(0, 82, 212, 0.8); }
        .crm-button.primary:hover { transform: translateY(-1px); box-shadow: 0 18px 40px -18px rgba(0, 82, 212, 0.35); }
        .crm-button.ghost { background: rgba(67, 100, 247, 0.08); color: var(--primary-color); }
        .crm-button.ghost:hover { background: rgba(67, 100, 247, 0.12); }
        .crm-button.sm,
        .crm-button.crm-button--sm { padding: 10px 16px; font-size: 0.85rem; }
        .viewing-slot-builder { display: flex; flex-direction: column; gap: 12px; padding: 16px; border-radius: 14px; border: 1px dashed rgba(0, 82, 212, 0.2); background: rgba(67, 100, 247, 0.04); }
        .reschedule-help { font-size: 0.88rem; color: var(--gray-color); margin: 0; }
        .reschedule-slot-list { display: flex; flex-direction: column; gap: 12px; }
        .reschedule-slot { display: grid; grid-template-columns: minmax(0, 1fr) auto; gap: 10px; align-items: center; }
        .reschedule-slot-fields { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; }
        .reschedule-slot input,
        .reschedule-slot select { width: 100%; border-radius: 10px; border: 1px solid var(--border-color); padding: 10px 12px; font-size: 0.9rem; background: var(--white-color); color: var(--dark-color); }
        .reschedule-slot input.is-invalid,
        .reschedule-slot select.is-invalid { border-color: #b91c1c; box-shadow: 0 0 0 2px rgba(185, 28, 28, 0.12); }
        .reschedule-actions { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
        .viewing-empty-state { font-size: 0.9rem; color: var(--gray-color); }
        .toast-container { position: fixed; top: 24px; right: 24px; display: flex; flex-direction: column; gap: 12px; z-index: 1100; }
        .toast { padding: 14px 18px; border-radius: 12px; box-shadow: 0 18px 38px -20px rgba(15, 23, 42, 0.35); color: var(--white-color); font-weight: 600; display: flex; align-items: center; gap: 10px; opacity: 0; transform: translateY(-10px); animation: toast-in 0.4s forwards; }
        .toast--success { background: linear-gradient(135deg, #16a34a, #22c55e); }
        .toast--info { background: linear-gradient(135deg, #2563eb, #3b82f6); }
        @keyframes toast-in { to { opacity: 1; transform: translateY(0); } }

        /* Footer (identic cu index.html) */
        .copyright { text-align: center; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); color: #999; font-size: 0.9rem; }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .venue-main-content {
                grid-template-columns: 1fr; /* Stack columns */
            }
            .right-column {
                position: static; /* Remove sticky on mobile */
                top: auto;
            }
            body[data-page="venue-details"] .gallery-section,
            .left-column,
            .right-column {
                grid-column: 1;
                grid-row: auto;
            }
            .venue-name {
                font-size: 2rem;
            }
            .left-column h2, .right-column h3 {
                font-size: 1.5rem;
            }
            .details-grid {
                grid-template-columns: 1fr;
            }
            .event-types-list {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            .facilities-list {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body[data-page="venue-details"] .venue-main-content {
                display: flex;
                flex-direction: column;
            }
            body[data-page="venue-details"] .gallery-grid,
            body[data-page="venue-details"] .thumbnail-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                height: auto;
            }
            body[data-page="venue-details"] .gallery-grid {
                grid-template-rows: repeat(3, 200px);
            }
            body[data-page="venue-details"] .thumbnail-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            body[data-page="venue-details"] .gallery-item.main-image {
                grid-column: auto;
                grid-row: auto;
            }
            body[data-page="venue-details"] .gallery-item {
                height: 250px;
            }
            body[data-page="venue-details"] .thumbnail-grid .gallery-item {
                height: 150px;
            }
        }
    </style>
</head>
<body data-page="venue-details">
    <div data-include="header.html"></div>
    <div data-include="mobile-menu.html"></div>

    <main>
        <section class="main-search-section">
            <div class="container">
                <div
                    data-search-default-action="navigate"
                    data-search-navigate-to="locations.html"
                    data-include="search-box.html">
                </div>
            </div>
        </section>

        <section class="hero-section">
            <div class="container">
                <nav class="breadcrumbs" data-venue-breadcrumb>
                    <a href="index.html">Acasă</a> <span>&gt;</span>
                    <a href="locations.html">Locații</a> <span>&gt;</span>
                    <span>Locație</span>
                </nav>
                <div class="venue-name">
                    <h1 data-venue-name>Locație eveniment</h1>
                    <button class="favorite-btn" data-venue-favorite title="Adaugă la favorite"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></button>
                </div>
                <p class="venue-address" data-venue-city>București, România</p>
                <div class="venue-tags" data-venue-tags>
                    <span class="tag">Locație premium</span>
                </div>
                <p class="venue-description" data-venue-description>The Grand Ballroom este o locație de lux situată în inima Bucureștiului, perfectă pentru evenimente grandioase. Cu o arhitectură impresionantă și servicii impecabile, oferim o experiență de neuitat pentru nunți, gale și conferințe.</p>
            </div>
        </section>

        <div class="container venue-main-content">
            <section class="gallery-section">
                <div class="gallery-grid">
                    <div class="gallery-item main-image"><img src="https://nuntapeplaja.ro/wp-content/uploads/2022/01/1-Cum-poti-face-o-nunta-la-castel-1-1024x682.jpg.webp" alt="Sală de nuntă elegantă"></div>
                    <div class="gallery-item"><img src="https://castelmimi.md/wp-content/uploads/2025/01/Rezumat-4.jpg" alt="Ceremonie de nuntă în aer liber"></div>
                    <div class="gallery-item"><img src="https://castelmimi.md/wp-content/uploads/2023/07/IMG_2207-scaled-1.webp" alt="Mese aranjate pentru nuntă"></div>
                </div>
                <div class="thumbnail-grid">
                    <div class="gallery-item"><img src="https://honeypot0.s3.amazonaws.com/1743249766722-gallery-Locatii%20nunta%20bucuresti.jpg" alt="Detaliu aranjament masă nuntă"></div>
                    <div class="gallery-item"><img src="https://www.treehouse.ro/image-thumbnail-800x600-upl/photos/locatii_17_15438.jpg" alt="Aranjament floral"></div>
                    <div class="gallery-item"><img src="https://vanillaevents.ro/wp-content/uploads/2023/08/Nunta-La-Foret-12-1.jpg" alt="Sală de bal goală, pregătită pentru eveniment"></div>
                    <div class="gallery-item"><img src="https://www.mogosoaialakeview.ro/images/evenimente/nunta/nunta-interior.jpg" alt="Mese rotunde la o recepție de nuntă"></div>
                    <div class="gallery-item last-image">
                        <img src="https://lh5.googleusercontent.com/xs1ERpSe0B9YGjmakWrLx4VoBTuOdCM5PdBmHADECdkufvjDkR_rhxJvvMsbi_CzzuLz2Vluti4v62_t68fk3UmKbc564WlPQ6cRep8m7iX_Fze-GHrQIGgVwdDm9w7hYnjR11QX=s0" alt="Loc de ceremonie nuntă pe plajă">
                        <button class="show-all-photos-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm-11-4l2.03 2.71L16 11l4 5H8l3-4zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"></path></svg>
                            Vezi toate fotografiile
                        </button>
                    </div>
                </div>
            </section>

            <div class="left-column">
                <section class="about-section">
                    <h2>Despre această locație</h2>
                    <p>The Grand Ballroom este o locație de evenimente de prestigiu, renumită pentru eleganța sa atemporală și serviciile excepționale. Situată central, oferă acces facil și o ambianță sofisticată, ideală pentru evenimente de anvergură. Spațiul generos și designul interior rafinat pot fi adaptate pentru a se potrivi oricărui concept, de la nunți de vis la conferințe internaționale și petreceri corporate exclusiviste.</p>
                    <p>Echipa noastră dedicată de event planneri vă stă la dispoziție pentru a asigura că fiecare detaliu este perfect, de la meniul personalizat, la aranjamentele florale și sistemele de sunet și lumini de ultimă generație. Ne mândrim cu crearea unor experiențe memorabile, transformând viziunea dumneavoastră în realitate.</p>
                </section>

                <section class="details-facilities-section">
                    <h3>Detalii Eveniment</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"></path></svg>
                            Capacitate: <strong>150 - 400 invitați</strong>
                        </div>
                        <div class="detail-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg>
                            Rating: <strong>9.4 (Superb)</strong>
                        </div>
                        <div class="detail-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path></svg>
                            Locație: <strong>București, Centru</strong>
                        </div>
                    </div>

                    <h3>Stiluri și Teme</h3>
                    <ul class="facilities-list" style="
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 8px 20px;
                    ">
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Elegant</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Modern</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Minimalist</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Clasic</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Boho-Chic</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Glamour</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Rustic</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Natură</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Central</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Panoramic</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Istoric</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Exclusivist</span></li>
                    </ul>

                    <h3>Tipuri de evenimente acceptate</h3>
                    <ul class="event-types-list">
                        <li>Nuntă</li>
                        <li>Botez</li>
                        <li>Eveniment Corporate</li>
                        <li>Petrecere Privată</li>
                        <li>Cununie Civilă</li>
                    </ul>

                    <h3>Facilități disponibile</h3>
                    <ul class="facilities-list" style="
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        gap: 8px 20px;
                    ">
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Terasă / Grădină</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Servicii de catering personalizate</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Bar (serviciu complet)</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Decor (servicii de amenajare)</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Parcare privată</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Cazare invitati</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Cameră miri</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Piscina</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Vedere lac</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Ponton</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Event planner dedicat</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Wi-Fi gratuit de mare viteză</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Sistem de sunet și lumini profesional</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Ceremonie in aer liber</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Kids corner</span></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Spațiu lounge</span></li>
                    </ul>
                </section>

                <section class="contact-section-locked" data-contact-locked>
                    <h3>Contact locație</h3>
                    <div class="locked-content">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"></path></svg>
                        <p data-contact-locked-message>Pentru a vizualiza detaliile de contact, te rugăm să te autentifici.</p>
                        <div class="locked-actions" data-contact-locked-actions>
                            <a href="login.html" class="cta-button">Autentificare</a>
                        </div>
                    </div>
                </section>

                <section class="contact-section" hidden>
                    <h3>Contact</h3>
                    <div class="contact-grid">
                        <div class="contact-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                            <div class="contact-item-info">
                                <span>Telefon</span>
                                <strong>+40 722 111 222</strong>
                            </div>
                        </div>
                        <div class="contact-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                            <div class="contact-item-info">
                                <span>Email</span>
                                <strong>alexandra.venue@ouido.com</strong>
                            </div>
                        </div>
                        <div class="contact-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/></svg>
                            <div class="contact-item-info">
                                <span>Adresă</span>
                                <strong data-venue-address>Adresă indisponibilă</strong>
                            </div>
                        </div>
                        <div class="contact-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                            <div class="contact-item-info">
                                <span>Program recomandat</span>
                                <strong>luni: 12:00–19:30 | marți: 12:00–19:30 | miercuri: 12:00–19:30 | joi: 12:00–19:30 | vineri: 12:00–19:30 | sâmbătă: Închis | duminică: Închis</strong>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

        <div class="right-column">
          <div class="availability-widget sticky-widget" data-availability-widget>
            <h3>Disponibilitate și pre-rezervare</h3>
            <div class="availability-calendar-shell" data-availability-calendar-shell>
                <input type="hidden" id="widget-availability-picker">
                <div id="widget-availability-calendar" class="availability-calendar"></div>
                <div class="availability-legend">
                    <span><span class="availability-legend-dot availability-legend-dot--available"></span>Disponibil</span>
                    <span><span class="availability-legend-dot availability-legend-dot--hold"></span>Pre-rezervat</span>
                    <span><span class="availability-legend-dot availability-legend-dot--booked"></span>Ocupat</span>
                </div>
            </div>
            <p class="price-display">Preț de la <strong data-venue-price>0€</strong>/pers</p>
            <div class="widget-actions" data-widget-actions>
                <a href="login.html" class="cta-button">Confirmă disponibilitatea</a>
            </div>
            <p class="widget-note">După confirmarea disponibilității, proprietarul va putea aproba pre-rezervarea ta.</p>
          </div>
        </div>
        </div>
    </main>

    <div data-include="footer.html"></div>

    <div class="toast-container" data-toast-container></div>

    <div class="favorites-modal-overlay" id="availability-modal">
        <div class="favorites-modal" role="dialog" aria-modal="true" aria-labelledby="availability-modal-title">
            <header>
                <div>
                    <h3 id="availability-modal-title">Cere disponibilitatea</h3>
                    <p id="availability-modal-subtitle" class="panel-meta">Selectează data dorită și detaliile evenimentului.</p>
                </div>
                <button type="button" class="favorites-modal-close" id="availability-modal-close" aria-label="Închide">×</button>
            </header>
            <form id="availability-form">
                <div class="form-section">
                    <input type="hidden" id="availability-date-picker">
                    <div id="availability-calendar" class="availability-calendar"></div>
                    <div class="availability-legend">
                        <span><span class="availability-legend-dot availability-legend-dot--available"></span>Disponibil</span>
                        <span><span class="availability-legend-dot availability-legend-dot--hold"></span>Pre-rezervat</span>
                        <span><span class="availability-legend-dot availability-legend-dot--booked"></span>Ocupat</span>
                    </div>
                </div>
                <p class="panel-meta" id="availability-selected-date">Selectează o dată disponibilă din calendar.</p>
                <div class="form-row">
                    <div>
                        <label for="availability-event-type">Tip eveniment</label>
                        <select id="availability-event-type" required></select>
                    </div>
                    <div>
                        <label for="availability-guests">Număr invitați</label>
                        <input type="number" id="availability-guests" min="10" max="600" required>
                    </div>
                </div>
                <footer>
                    <button type="button" class="crm-button ghost" id="availability-cancel-btn">Renunță</button>
                    <button type="submit" class="crm-button primary">Trimite cererea</button>
                </footer>
            </form>
        </div>
    </div>

    <div class="favorites-modal-overlay" id="viewing-modal">
        <div class="favorites-modal" role="dialog" aria-modal="true" aria-labelledby="viewing-modal-title">
            <header>
                <div>
                    <h3 id="viewing-modal-title">Programează o vizionare</h3>
                    <p id="viewing-modal-subtitle" class="panel-meta">Selectează data și ora preferată pentru vizionarea locației.</p>
                </div>
                <button type="button" class="favorites-modal-close" id="viewing-modal-close" aria-label="Închide">×</button>
            </header>
            <form id="viewing-form">
                <div class="viewing-slot-builder">
                    <p class="reschedule-help" data-viewing-slot-hint>Selectează până la 4 intervale (dată și oră) pentru vizionare. Intervalele sunt din 30 în 30 de minute.</p>
                    <div class="reschedule-slot-list" data-viewing-suggestions></div>
                    <div class="reschedule-actions">
                        <button type="button" class="crm-button ghost sm" id="viewing-add-slot" data-viewing-add-slot>Adaugă interval</button>
                        <span class="panel-meta" id="viewing-slot-counter" hidden></span>
                    </div>
                </div>
                <div class="viewing-empty-state" data-viewing-empty-state hidden>Încă nu ai intervale salvate. Folosește butonul „Adaugă interval” pentru a propune variantă de vizită.</div>
                <p class="panel-meta" id="viewing-selected-date">Lista de intervale va fi trimisă către locație. Alege cel puțin o variantă înainte de a continua.</p>
                <footer>
                    <button type="button" class="crm-button ghost" id="viewing-cancel-btn">Renunță</button>
                    <button type="submit" class="crm-button primary">Trimite solicitarea</button>
                </footer>
            </form>
        </div>
    </div>

    <!-- Lightbox/Modal HTML -->
    <div id="lightbox" class="lightbox">
        <span class="close-lightbox">&times;</span>
        <img class="lightbox-content" id="lightbox-image" src="" alt="Imagine mărită">
        <!-- NOU: Butoane de navigare -->
        <button class="lightbox-nav prev" aria-label="Imaginea anterioară">&#10094;</button>
        <button class="lightbox-nav next" aria-label="Imaginea următoare">&#10095;</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ro.js"></script>
    <script src="main.js"></script>

    <script>
        const SAMPLE_LOCATIONS = [
            { id: 1, name: 'The Grand Ballroom', city: 'București', price: 120, tags: ['Exclusivist', 'Panoramic', 'Capacitate Mare'], rating: 9.4 },
            { id: 2, name: 'Forest Retreat & Spa', city: 'Brașov', price: 95, tags: ['Natură', 'Piscină'], rating: 9.8 },
            { id: 3, name: 'Cluj SkyView', city: 'Cluj-Napoca', price: 110, tags: ['Modern', 'Rooftop'], rating: 9.1 },
            { id: 4, name: 'Palatul Noblesse', city: 'Iași', price: 105, tags: ['Istoric', 'Elegant'], rating: 8.9 },
            { id: 5, name: 'Laguna Albastră', city: 'Constanța', price: 130, tags: ['Plajă', 'Vedere la mare'], rating: 9.5 },
            { id: 6, name: 'Conacul din Vii', city: 'Prahova', price: 85, tags: ['Rustic', 'Tradițional'], rating: 8.5 },
            { id: 7, name: 'Ambiance Lake', city: 'Snagov', price: 150, tags: ['Lac', 'Natură'], rating: 9.6 },
            { id: 8, name: 'Mountain Peak', city: 'Sinaia', price: 100, tags: ['Munte', 'Panoramic'], rating: 9.2 },
            { id: 9, name: 'Urban Loft', city: 'Timișoara', price: 75, tags: ['Industrial', 'Modern'], rating: 8.2 },
            { id: 10, name: 'Grădina cu Lavandă', city: 'Sibiu', price: 90, tags: ['Grădină', 'Romantic'], rating: 9.0 },
            { id: 11, name: 'Delta Paradise', city: 'Tulcea', price: 70, tags: ['Natură', 'Delta'], rating: 7.8 },
            { id: 12, name: 'Centrul de Conferințe Oradea', city: 'Oradea', price: 65, tags: ['Business', 'Modern'], rating: 6.9 }
        ];
        const KNOWN_ROLES = ['guest', 'client', 'owner', 'admin'];
        const AUTHENTICATED_ROLES = new Set(['client', 'owner', 'admin']);
        let activeVenue = null;
        let ensureWidgetCalendarVisibility = () => {};

        function normalizeRole(value) {
            return KNOWN_ROLES.includes(value) ? value : 'guest';
        }

        function syncAuthStateWithRole(nextRole) {
            const storedRole = localStorage.getItem('userRole');
            const normalizedInput = normalizeRole(typeof nextRole === 'string' ? nextRole : storedRole);
            if (storedRole !== normalizedInput) {
                localStorage.setItem('userRole', normalizedInput);
            }
            const shouldBeLoggedIn = AUTHENTICATED_ROLES.has(normalizedInput);
            localStorage.setItem('isLoggedIn', shouldBeLoggedIn ? 'true' : 'false');
            return normalizedInput;
        }

        function applyVenueRoleState(venue = activeVenue) {
            if (!venue) return;
            setupAvailabilityWidget(venue);
            setupContactVisibility(venue);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeGalleryLightbox();
            activeVenue = resolveVenueFromParams();
            hydrateHero(activeVenue);
            setupFavorites(activeVenue);
            syncAuthStateWithRole();
            applyVenueRoleState(activeVenue);

            document.addEventListener('role:change', (event) => {
                syncAuthStateWithRole(event?.detail?.role);
                applyVenueRoleState(activeVenue);
            });

            window.addEventListener('storage', (event) => {
                if (event.key === 'userRole' || event.key === 'clientAvailabilityConfirmedIds') {
                    syncAuthStateWithRole();
                    applyVenueRoleState(activeVenue);
                }
            });
        });

        function resolveVenueFromParams() {
            const params = new URLSearchParams(window.location.search);
            const idParam = parseInt(params.get('id'), 10);
            const venue = SAMPLE_LOCATIONS.find((loc) => loc.id === idParam);
            return venue || SAMPLE_LOCATIONS[0];
        }

        function hydrateHero(venue) {
            if (!venue) return;
            const nameEl = document.querySelector('[data-venue-name]');
            const breadcrumb = document.querySelector('[data-venue-breadcrumb] span:last-child');
            const cityEl = document.querySelector('[data-venue-city]');
            const tagsContainer = document.querySelector('[data-venue-tags]');
            const priceEl = document.querySelector('[data-venue-price]');
            const favoriteBtn = document.querySelector('[data-venue-favorite]');
            const descriptionEl = document.querySelector('[data-venue-description]');
            const addressEl = document.querySelector('[data-venue-address]');

            if (nameEl) nameEl.textContent = venue.name;
            if (breadcrumb) breadcrumb.textContent = venue.name;
            if (cityEl) cityEl.textContent = `${venue.city}, România`;
            if (tagsContainer) {
                tagsContainer.innerHTML = '';
                (Array.isArray(venue.tags) && venue.tags.length ? venue.tags : ['Locație eveniment']).forEach((tag) => {
                    const span = document.createElement('span');
                    span.className = 'tag';
                    span.textContent = tag;
                    tagsContainer.appendChild(span);
                });
            }
            if (priceEl) priceEl.textContent = `${venue.price}€`;
            if (favoriteBtn) favoriteBtn.dataset.id = String(venue.id);
            if (descriptionEl) {
                descriptionEl.textContent = `${venue.name} este una dintre locațiile recomandate OuidoEvents din ${venue.city}, pregătită să găzduiască evenimente memorabile cu servicii complete și echipă dedicată.`;
            }
            if (addressEl) {
                const address = venue.address || `${venue.city}, România`;
                addressEl.textContent = address;
            }
            document.title = `${venue.name} · OuidoEvents`;
        }

        function getStoredFavoriteIds() {
            try {
                const raw = localStorage.getItem('favoriteIds');
                if (!raw) return [];
                const parsed = JSON.parse(raw);
                return Array.isArray(parsed) ? parsed : [];
            } catch (error) {
                return [];
            }
        }

        function setupFavorites(venue) {
            const favButton = document.querySelector('[data-venue-favorite]');
            if (!favButton || !venue) return;

            let favoriteIds = getStoredFavoriteIds();
            const syncFavoriteState = () => {
                favoriteIds = getStoredFavoriteIds();
                favButton.classList.toggle('is-favorite', favoriteIds.includes(venue.id));
            };

            syncFavoriteState();

            favButton.addEventListener('click', () => {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                if (!isLoggedIn) {
                    window.location.href = 'login.html';
                    return;
                }
                favoriteIds = getStoredFavoriteIds();
                const isFavorite = favoriteIds.includes(venue.id);
                if (isFavorite) {
                    favoriteIds = favoriteIds.filter((id) => id !== venue.id);
                } else {
                    favoriteIds.push(venue.id);
                }
                localStorage.setItem('favoriteIds', JSON.stringify(favoriteIds));
                syncFavoriteState();
            });
        }

        function setupAvailabilityWidget(venue) {
            const widget = document.querySelector('[data-availability-widget]');
            if (!widget || !venue) return;

            const calendarShell = widget.querySelector('[data-availability-calendar-shell]');
            const actionsContainer = widget.querySelector('[data-widget-actions]');
            const widgetCalendarContainer = document.getElementById('widget-availability-calendar');
            const widgetCalendarInput = document.getElementById('widget-availability-picker');

            if (!actionsContainer) return;

            const userRole = normalizeRole(localStorage.getItem('userRole'));
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const hasClientConfirmed = userRole === 'client' && hasConfirmedAvailability(venue.id);
            const shouldShowClientActions = isLoggedIn && AUTHENTICATED_ROLES.has(userRole);

            if (calendarShell) {
                calendarShell.hidden = false;
            }

            ensureWidgetCalendarVisibility = () => {};
            actionsContainer.innerHTML = '';

            const buildWidgetCalendar = () => {
                if (!calendarShell || !widgetCalendarContainer || !widgetCalendarInput) return;
                calendarShell.hidden = false;
                widgetCalendarContainer.classList.remove('is-empty');

                if (widgetCalendarInput._flatpickr) {
                    widgetCalendarInput._flatpickr.destroy();
                    widgetCalendarInput._flatpickr = null;
                }

                if (typeof flatpickr !== 'function') return;
                if (typeof flatpickr.localize === 'function' && flatpickr.l10ns?.ro) {
                    flatpickr.localize(flatpickr.l10ns.ro);
                }

                if (widgetCalendarContainer) {
                    widgetCalendarContainer.innerHTML = '';
                }

                widgetCalendarInput._flatpickr = flatpickr(widgetCalendarInput, {
                    inline: true,
                    minDate: 'today',
                    disableMobile: true,
                    showMonths: 1,
                    appendTo: widgetCalendarContainer,
                    onDayCreate: (selectedDates, dateStr, calendarInstance, dayElem) => {
                        const status = getAvailabilityStatus(venue.id, dayElem.dateObj);
                        dayElem.classList.remove('availability-day-hold', 'availability-day-booked', 'availability-day-available');
                        if (status === 'hold') {
                            dayElem.classList.add('availability-day-hold');
                        } else if (status === 'booked') {
                            dayElem.classList.add('availability-day-booked', 'flatpickr-disabled');
                        } else {
                            dayElem.classList.add('availability-day-available');
                        }
                    },
                    disable: [(date) => getAvailabilityStatus(venue.id, date) === 'booked']
                });
            };

            ensureWidgetCalendarVisibility = buildWidgetCalendar;
            buildWidgetCalendar();

            if (!shouldShowClientActions) {
                const link = document.createElement('a');
                link.href = 'login.html';
                link.className = 'cta-button';
                link.textContent = 'Confirmă disponibilitatea';
                actionsContainer.appendChild(link);
                return;
            }

            const availabilityBtn = document.createElement('button');
            availabilityBtn.type = 'button';
            availabilityBtn.className = 'cta-button';
            availabilityBtn.textContent = 'Confirmă disponibilitatea';

            const viewingBtn = document.createElement('button');
            viewingBtn.type = 'button';
            viewingBtn.className = 'cta-button ghost';
            viewingBtn.textContent = 'Programează o vizionare';

            actionsContainer.appendChild(availabilityBtn);
            actionsContainer.appendChild(viewingBtn);

            availabilityBtn.addEventListener('click', () => {
                ensureWidgetCalendarVisibility();
                openAvailabilityModal(venue);
            });

            viewingBtn.addEventListener('click', () => {
                ensureWidgetCalendarVisibility();
                openViewingModal(venue);
            });

            const shouldAutoShowCalendar =
                userRole === 'owner' || userRole === 'admin' || hasClientConfirmed;

            if (shouldAutoShowCalendar) {
                ensureWidgetCalendarVisibility();
            }
        }

        function setupContactVisibility(venue) {
            if (!venue) return;

            const lockedSection = document.querySelector('[data-contact-locked]');
            const contactSection = document.querySelector('.contact-section');
            const lockedMessage = lockedSection?.querySelector('[data-contact-locked-message]');
            const lockedActions = lockedSection?.querySelector('[data-contact-locked-actions]');
            const addressEl = contactSection?.querySelector('[data-venue-address]');
            const userRole = normalizeRole(localStorage.getItem('userRole'));

            if (!lockedSection || !contactSection || !lockedMessage || !lockedActions) return;

            if (addressEl && venue) {
                const address = venue.address || (venue.city ? `${venue.city}, România` : 'Adresă indisponibilă');
                addressEl.textContent = address;
            }

            contactSection.hidden = true;
            contactSection.classList.remove('is-visible');
            lockedSection.hidden = false;
            lockedActions.innerHTML = '';

            const showContact = () => {
                lockedSection.hidden = true;
                contactSection.hidden = false;
                requestAnimationFrame(() => contactSection.classList.add('is-visible'));
            };

            if (userRole === 'owner' || userRole === 'admin') {
                showContact();
                return;
            }

            if (userRole === 'client') {
                if (hasConfirmedAvailability(venue.id)) {
                    showContact();
                    return;
                }
                lockedMessage.textContent = 'Confirmă disponibilitatea locației pentru a debloca detaliile de contact.';
                const confirmBtn = document.createElement('button');
                confirmBtn.type = 'button';
                confirmBtn.className = 'cta-button';
                confirmBtn.textContent = 'Confirmă disponibilitatea';
                confirmBtn.addEventListener('click', () => {
                    ensureWidgetCalendarVisibility();
                    openAvailabilityModal(venue);
                });
                lockedActions.appendChild(confirmBtn);
                return;
            }

            lockedMessage.textContent = 'Pentru a vizualiza detaliile de contact, te rugăm să te autentifici.';
            const loginLink = document.createElement('a');
            loginLink.href = 'login.html';
            loginLink.className = 'cta-button';
            loginLink.textContent = 'Autentificare';
            lockedActions.appendChild(loginLink);
        }

        function initializeGalleryLightbox() {
            const galleryItems = document.querySelectorAll('.gallery-item');
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const closeLightbox = document.querySelector('.close-lightbox');
            const prevButton = document.querySelector('.lightbox-nav.prev');
            const nextButton = document.querySelector('.lightbox-nav.next');
            const showAllButton = document.querySelector('.show-all-photos-btn');
            const allImages = [];
            let currentImageIndex = 0;

            if (!galleryItems.length || !lightbox) return;

            galleryItems.forEach((item) => {
                const img = item.querySelector('img');
                if (img) {
                    allImages.push(img.src);
                }
            });

            const openLightbox = (index) => {
                currentImageIndex = index;
                lightboxImage.src = allImages[currentImageIndex];
                lightbox.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            };

            const closeLightboxFunc = () => {
                lightbox.style.display = 'none';
                document.body.style.overflow = '';
            };

            const showImage = (index) => {
                currentImageIndex = (index + allImages.length) % allImages.length;
                lightboxImage.src = allImages[currentImageIndex];
            };

            galleryItems.forEach((item, index) => {
                item.addEventListener('click', () => openLightbox(index));
            });

            if (showAllButton) {
                showAllButton.addEventListener('click', (event) => {
                    event.stopPropagation();
                    openLightbox(0);
                });
            }

            closeLightbox?.addEventListener('click', closeLightboxFunc);
            prevButton?.addEventListener('click', () => showImage(currentImageIndex - 1));
            nextButton?.addEventListener('click', () => showImage(currentImageIndex + 1));
            lightbox.addEventListener('click', (event) => {
                if (event.target === lightbox) {
                    closeLightboxFunc();
                }
            });

            document.addEventListener('keydown', (event) => {
                if (lightbox.style.display === 'flex') {
                    if (event.key === 'ArrowRight') showImage(currentImageIndex + 1);
                    if (event.key === 'ArrowLeft') showImage(currentImageIndex - 1);
                    if (event.key === 'Escape') closeLightboxFunc();
                }
            });
        }

        const eventTypeOptions = ['Nuntă', 'Botez', 'Cununie Civilă', 'Eveniment Corporate', 'Petrecere Privată', 'Aniversare'];
        const availabilityState = { locationId: null, locationName: '', selectedDate: null };
        const viewingState = { locationId: null, slots: [] };
        const viewingSuggestionPickers = new Map();
        const MAX_VIEWING_SLOTS = 4;
        const MIN_VIEWING_SLOTS = 2;

        function openAvailabilityModal(venue) {
            const overlay = document.getElementById('availability-modal');
            if (!overlay || !venue) return;

            availabilityState.locationId = venue.id;
            availabilityState.locationName = venue.name;
            availabilityState.selectedDate = null;

            const subtitle = document.getElementById('availability-modal-subtitle');
            const eventTypeSelect = document.getElementById('availability-event-type');
            const guestsInput = document.getElementById('availability-guests');

            if (subtitle) subtitle.textContent = `Selectează data pentru ${venue.name}`;
            if (eventTypeSelect && !eventTypeSelect.options.length) {
                eventTypeOptions.forEach((option) => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    eventTypeSelect.appendChild(opt);
                });
            }
            if (eventTypeSelect) eventTypeSelect.value = eventTypeOptions[0];
            if (guestsInput) guestsInput.value = '';

            ensureAvailabilityDatePicker();
            updateAvailabilitySelectedDate();

            overlay.classList.add('is-visible');
        }

        function ensureAvailabilityDatePicker() {
            const calendarContainer = document.getElementById('availability-calendar');
            const dateInput = document.getElementById('availability-date-picker');
            if (!calendarContainer || !dateInput || typeof flatpickr !== 'function') return null;

            if (typeof flatpickr.localize === 'function' && flatpickr.l10ns?.ro) {
                flatpickr.localize(flatpickr.l10ns.ro);
            }

            if (!ensureAvailabilityDatePicker.instance) {
                ensureAvailabilityDatePicker.instance = flatpickr(dateInput, {
                    minDate: 'today',
                    locale: flatpickr.l10ns?.ro || 'default',
                    disableMobile: true,
                    monthSelectorType: 'dropdown',
                    yearSelectorType: 'dropdown',
                    inline: true,
                    appendTo: calendarContainer,
                    onChange: (selectedDates) => {
                        availabilityState.selectedDate = selectedDates[0] || null;
                        updateAvailabilitySelectedDate();
                    },
                    onDayCreate: (selectedDates, dateStr, instance, dayElem) => {
                        const status = getAvailabilityStatus(availabilityState.locationId, dayElem.dateObj);
                        dayElem.classList.remove('availability-day-hold', 'availability-day-booked', 'availability-day-available');
                        if (status === 'hold') {
                            dayElem.classList.add('availability-day-hold');
                        } else if (status === 'booked') {
                            dayElem.classList.add('availability-day-booked', 'flatpickr-disabled');
                        } else {
                            dayElem.classList.add('availability-day-available');
                        }
                    },
                    disable: [
                        (date) => getAvailabilityStatus(availabilityState.locationId, date) === 'booked'
                    ]
                });
            }

            const picker = ensureAvailabilityDatePicker.instance;
            picker.clear(false);
            picker.redraw();
            picker.jumpToDate('today');
            availabilityState.selectedDate = null;
            updateAvailabilitySelectedDate();
            return picker;
        }

        function updateAvailabilitySelectedDate() {
            const label = document.getElementById('availability-selected-date');
            if (!label) return;
            if (!availabilityState.selectedDate) {
                label.textContent = 'Selectează o dată disponibilă din calendar.';
            } else {
                label.textContent = `Data selectată: ${formatDate(availabilityState.selectedDate)}`;
            }
        }

        function closeAvailabilityModal() {
            const overlay = document.getElementById('availability-modal');
            overlay?.classList.remove('is-visible');
        }

        function openViewingModal(venue) {
            const overlay = document.getElementById('viewing-modal');
            if (!overlay || !venue) return;

            viewingState.locationId = venue.id;
            viewingState.slots = [];

            const title = document.getElementById('viewing-modal-title');
            const subtitle = document.getElementById('viewing-modal-subtitle');
            if (title) title.textContent = `Programează o vizionare la ${venue.name}`;
            if (subtitle) subtitle.textContent = 'Selectează data și ora preferată pentru vizionare.';

            resetViewingSlots();
            createViewingSuggestionSlot();
            createViewingSuggestionSlot();
            overlay.classList.add('is-visible');
        }

        function closeViewingModal() {
            const overlay = document.getElementById('viewing-modal');
            overlay?.classList.remove('is-visible');
            resetViewingSlots();
        }

        function resetViewingSlots() {
            viewingSuggestionPickers.clear();
            viewingState.slots = [];
            const container = document.querySelector('[data-viewing-suggestions]');
            if (container) container.innerHTML = '';
            updateViewingSlotsControls();
        }

        function createViewingSuggestionSlot(initial = {}) {
            const container = document.querySelector('[data-viewing-suggestions]');
            if (!container || viewingSuggestionPickers.size >= MAX_VIEWING_SLOTS) return;

            const slotId = `slot-${Date.now()}-${Math.random().toString(16).slice(2)}`;
            const wrapper = document.createElement('div');
            wrapper.className = 'reschedule-slot';
            wrapper.dataset.slotId = slotId;

            const fields = document.createElement('div');
            fields.className = 'reschedule-slot-fields';

            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.value = initial.date || '';

            const timeSelect = document.createElement('select');
            buildTimeOptions(timeSelect, initial.time);

            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'crm-button ghost sm';
            removeBtn.textContent = 'Șterge';
            removeBtn.dataset.viewingRemoveSlot = '';

            removeBtn.addEventListener('click', () => {
                viewingSuggestionPickers.delete(slotId);
                wrapper.remove();
                updateViewingSlotsControls();
            });

            fields.appendChild(dateInput);
            fields.appendChild(timeSelect);
            wrapper.appendChild(fields);
            wrapper.appendChild(removeBtn);
            container.appendChild(wrapper);

            viewingSuggestionPickers.set(slotId, { dateInput, timeSelect });
            updateViewingSlotsControls();
        }

        function buildTimeOptions(select, selectedValue) {
            select.innerHTML = '<option value="">Selectează ora</option>';
            for (let hour = 8; hour <= 20; hour += 1) {
                for (const minute of [0, 30]) {
                    if (hour === 20 && minute > 0) continue;
                    const value = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = value;
                    if (value === selectedValue) option.selected = true;
                    select.appendChild(option);
                }
            }
        }

        function updateViewingSlotsControls() {
            const counter = document.getElementById('viewing-slot-counter');
            const hint = document.querySelector('[data-viewing-slot-hint]');
            const emptyState = document.querySelector('[data-viewing-empty-state]');
            const addButton = document.querySelector('[data-viewing-add-slot]');
            const total = viewingSuggestionPickers.size;
            const completed = Array.from(viewingSuggestionPickers.values()).filter(({ dateInput, timeSelect }) => dateInput.value && timeSelect.value).length;

            if (counter) {
                counter.hidden = total === 0;
                counter.textContent = `${total}/${MAX_VIEWING_SLOTS} intervale`;
            }

            if (hint) {
                if (total >= MAX_VIEWING_SLOTS) {
                    hint.textContent = 'Ai configurat 4 intervale. Șterge unul dacă vrei să adaugi altul.';
                } else {
                    const remaining = MAX_VIEWING_SLOTS - total;
                    hint.textContent = `Poți adăuga încă ${remaining} ${remaining === 1 ? 'interval' : 'intervale'} (din 30 în 30 de minute).`;
                }
            }

            if (emptyState) {
                emptyState.hidden = total > 0;
            }

            if (addButton) {
                addButton.disabled = total >= MAX_VIEWING_SLOTS;
            }

            const removeButtons = document.querySelectorAll('[data-viewing-remove-slot]');
            const hideRemove = total <= MIN_VIEWING_SLOTS;
            removeButtons.forEach((button) => {
                button.hidden = hideRemove;
                button.disabled = hideRemove;
            });

            viewingState.slots = collectViewingSlots();
            const summary = document.getElementById('viewing-selected-date');
            if (summary) {
                if (!completed) {
                    summary.textContent = 'Lista de intervale va fi trimisă către locație. Alege cel puțin o variantă înainte de a continua.';
                } else if (completed === 1) {
                    summary.textContent = 'Trimiți 1 interval preferat către locație.';
                } else {
                    summary.textContent = `Trimiți ${completed} intervale preferate către locație.`;
                }
            }
        }

        function collectViewingSlots() {
            const slots = [];
            viewingSuggestionPickers.forEach(({ dateInput, timeSelect }) => {
                if (!dateInput.value || !timeSelect.value) return;
                const dateValue = dateInput.value;
                const timeValue = timeSelect.value;
                const [hour, minute] = timeValue.split(':').map(Number);
                const date = new Date(dateValue);
                date.setHours(hour || 0, minute || 0, 0, 0);
                slots.push({
                    iso: date.toISOString(),
                    label: `${formatDate(date)} · ${formatTime(date)}`
                });
            });
            return slots;
        }

        function getClientRequests() {
            try {
                const raw = localStorage.getItem('clientRequests');
                if (!raw) return [];
                const parsed = JSON.parse(raw);
                return Array.isArray(parsed) ? parsed : [];
            } catch (error) {
                return [];
            }
        }

        function saveClientRequests(requests) {
            localStorage.setItem('clientRequests', JSON.stringify(requests));
        }

        function hasConfirmedAvailability(locationId) {
            const confirmedRaw = localStorage.getItem('clientAvailabilityConfirmedIds');
            if (!confirmedRaw) return false;
            try {
                const parsed = JSON.parse(confirmedRaw);
                return Array.isArray(parsed) && parsed.includes(locationId);
            } catch (error) {
                return false;
            }
        }

        function markAvailabilityConfirmed(locationId) {
            let ids = [];
            try {
                const raw = localStorage.getItem('clientAvailabilityConfirmedIds');
                ids = raw ? JSON.parse(raw) : [];
                if (!Array.isArray(ids)) ids = [];
            } catch (error) {
                ids = [];
            }
            if (!ids.includes(locationId)) {
                ids.push(locationId);
                localStorage.setItem('clientAvailabilityConfirmedIds', JSON.stringify(ids));
            }
        }

        function showToast(message, type = 'success') {
            const container = document.querySelector('[data-toast-container]');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-10px)';
                setTimeout(() => toast.remove(), 300);
            }, 3200);
        }

        function handleAvailabilitySubmit(event) {
            event.preventDefault();
            const guestsInput = document.getElementById('availability-guests');
            const eventTypeSelect = document.getElementById('availability-event-type');
            if (!availabilityState.locationId || !availabilityState.selectedDate) {
                window.alert('Selectează o dată disponibilă înainte de a continua.');
                return;
            }
            const guests = parseInt(guestsInput?.value || '0', 10);
            if (!Number.isFinite(guests) || guests < 10) {
                window.alert('Introdu un număr de invitați (minim 10).');
                return;
            }
            const eventType = eventTypeSelect?.value || eventTypeOptions[0];
            const venue =
                SAMPLE_LOCATIONS.find((loc) => loc.id === availabilityState.locationId) ||
                (activeVenue && activeVenue.id === availabilityState.locationId ? activeVenue : null);

            const requests = getClientRequests();
            const newRequest = {
                id: Date.now(),
                type: 'availability',
                status: 'Pre-rezervat',
                locationId: availabilityState.locationId,
                locationName: venue?.name || availabilityState.locationName,
                eventDate: availabilityState.selectedDate.toISOString(),
                guests,
                eventType,
                createdAt: new Date().toISOString()
            };
            requests.push(newRequest);
            saveClientRequests(requests);
            markAvailabilityConfirmed(availabilityState.locationId);
            ensureWidgetCalendarVisibility();
            closeAvailabilityModal();
            if (venue) {
                if (!activeVenue || activeVenue.id === venue.id) {
                    activeVenue = venue;
                }
                applyVenueRoleState(venue);
            } else {
                setupContactVisibility(activeVenue || { id: availabilityState.locationId });
            }
            showToast('Cererea ta de disponibilitate a fost trimisă!', 'success');
        }

        function handleViewingSubmit(event) {
            event.preventDefault();
            updateViewingSlotsControls();
            if (!viewingState.locationId) {
                window.alert('Selectează întâi o locație.');
                return;
            }

            let hasInvalid = false;
            viewingSuggestionPickers.forEach(({ dateInput, timeSelect }) => {
                dateInput.classList.remove('is-invalid');
                timeSelect.classList.remove('is-invalid');
                if (!dateInput.value) {
                    dateInput.classList.add('is-invalid');
                    setTimeout(() => dateInput.classList.remove('is-invalid'), 1500);
                    hasInvalid = true;
                }
                if (!timeSelect.value) {
                    timeSelect.classList.add('is-invalid');
                    setTimeout(() => timeSelect.classList.remove('is-invalid'), 1500);
                    hasInvalid = true;
                }
            });

            if (viewingState.slots.length < MIN_VIEWING_SLOTS) {
                window.alert(`Completează cel puțin ${MIN_VIEWING_SLOTS} intervale înainte de a trimite cererea.`);
                return;
            }
            if (hasInvalid) {
                return;
            }

            const venue = SAMPLE_LOCATIONS.find((loc) => loc.id === viewingState.locationId) || null;

            const requests = getClientRequests();
            const newRequest = {
                id: Date.now(),
                type: 'viewing',
                status: 'În așteptare',
                locationId: viewingState.locationId,
                locationName: venue?.name || '',
                slots: viewingState.slots,
                createdAt: new Date().toISOString()
            };
            requests.push(newRequest);
            saveClientRequests(requests);
            closeViewingModal();
            showToast('Solicitarea de vizionare a fost trimisă!', 'info');
        }

        document.getElementById('availability-form')?.addEventListener('submit', handleAvailabilitySubmit);
        document.getElementById('availability-modal-close')?.addEventListener('click', closeAvailabilityModal);
        document.getElementById('availability-cancel-btn')?.addEventListener('click', (event) => {
            event.preventDefault();
            closeAvailabilityModal();
        });
        document.getElementById('availability-modal')?.addEventListener('click', (event) => {
            if (event.target?.id === 'availability-modal') {
                closeAvailabilityModal();
            }
        });

        document.getElementById('viewing-form')?.addEventListener('submit', handleViewingSubmit);
        document.getElementById('viewing-modal-close')?.addEventListener('click', closeViewingModal);
        document.getElementById('viewing-cancel-btn')?.addEventListener('click', (event) => {
            event.preventDefault();
            closeViewingModal();
        });
        document.getElementById('viewing-modal')?.addEventListener('click', (event) => {
            if (event.target?.id === 'viewing-modal') {
                closeViewingModal();
            }
        });
        document.getElementById('viewing-add-slot')?.addEventListener('click', () => {
            createViewingSuggestionSlot();
        });

        function formatDate(date) {
            if (!(date instanceof Date) || Number.isNaN(date.getTime())) return '';
            return date.toLocaleDateString('ro-RO', { day: '2-digit', month: 'long', year: 'numeric' });
        }

        function formatTime(date) {
            if (!(date instanceof Date) || Number.isNaN(date.getTime())) return '';
            return date.toLocaleTimeString('ro-RO', { hour: '2-digit', minute: '2-digit' });
        }

        function getAvailabilityStatus(locationId, date) {
            if (!(date instanceof Date)) return 'available';
            const dayOfWeek = date.getDay();
            if (dayOfWeek === 0) return 'booked';
            const hash = (date.getDate() + (locationId || 1) * 3 + dayOfWeek) % 6;
            if (hash === 0) return 'booked';
            if (hash === 1) return 'hold';
            return 'available';
        }

        
    </script>
</body>
</html>
