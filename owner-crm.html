<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ouidoEvents · CRM proprietari</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ------------------- */
    /* --- Base Styles --- */
    /* ------------------- */
    :root {
      --primary-color: #0052d4;
      --secondary-color: #4364f7;
      --dark-color: #1a202c;
      --gray-color: #555555;
      --muted-color: #7a7f87;
      --light-gray-color: #f0f2f5;
      --bg-color: #f8f9fa;
      --white-color: #ffffff;
      --border-color: #e5eaf1;
      --shadow-color: rgba(0, 82, 212, 0.1);
      --border-radius: 12px;
      --header-height: 74px;
      --crm-sidebar-width: 280px;
      --crm-sidebar-width-collapsed: 90px;
      --crm-booked-color: #0052d4;
      --crm-prebooked-color: #28a745;
      --crm-request-color: #ffc107;
      --crm-visit-request-color: #6f42c1;
      --crm-unavailable-color: #6c757d;
      --crm-booked-bg: rgba(0, 82, 212, 0.1);
      --crm-prebooked-bg: rgba(40, 167, 69, 0.1);
      --crm-request-bg: rgba(255, 193, 7, 0.15);
      --crm-visit-request-bg: rgba(111, 66, 193, 0.1);
      --crm-unavailable-bg: rgba(108, 117, 125, 0.1);
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      scroll-behavior: smooth;
    }

    body {
      min-height: 100vh;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      color: var(--dark-color);
      line-height: 1.6;
      background-color: var(--light-gray-color);
    }

    a {
      color: inherit;
      text-decoration: none; 
    }

    img {
      max-width: 100%;
      display: block;
    }

    ul {
      list-style: none;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-weight: 700;
    }

    /* ------------------------- */
    /* --- Component Styles --- */
    /* ------------------------- */
    .cta-button, .secondary-cta-button, .crm-ghost-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 25px;
      border-radius: 50px;
      font-weight: 600;
      border: 1px solid transparent;
      transition: all 0.3s ease;
      cursor: pointer;
      white-space: nowrap;
    }

    .cta-button {
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
      color: var(--white-color);
      border: none;
    }

    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px var(--shadow-color);
    }
    
    .secondary-cta-button {
        background-color: transparent;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
        padding: 8px 25px;
    }

    .secondary-cta-button:hover {
        background-color: var(--primary-color);
        color: var(--white-color);
    }

    .crm-ghost-button {
      border-style: dashed;
      border-color: var(--border-color);
      background-color: transparent;
      color: var(--muted-color);
    }

    .crm-ghost-button:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      background-color: rgba(0, 82, 212, 0.08);
    }

    /* ----------------------------- */
    /* --- Owner CRM Page Styles --- */
    /* ----------------------------- */
    main.crm-shell {
      /* This is just a wrapper now */
    }

    .crm-app {
      display: flex;
      align-items: flex-start;
      padding-top: var(--header-height);
    }

    .crm-sidebar {
      position: sticky;
      top: var(--header-height); /* Make it sticky below the header */
      height: calc(100vh - var(--header-height));
      width: var(--crm-sidebar-width);
      background-color: var(--white-color);
      border-right: 1px solid var(--border-color);
      box-shadow: 12px 0 32px rgba(67, 100, 247, 0.08);
      display: flex;
      flex-direction: column;
      flex-shrink: 0; /* Prevent sidebar from shrinking */
      gap: 24px;
    }
    
    .crm-sidebar-inner {
        padding: 32px 24px;
        display: flex; flex-direction: column; flex-grow: 1;
    }

    .crm-sidebar-header {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .crm-sidebar-logo {
      font-weight: 700;
      font-size: 1.6rem;
      text-decoration: none;
      color: var(--primary-color);
      letter-spacing: -0.3px;
    }

    .crm-sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex-grow: 1;
    }

    .crm-nav-link {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 14px;
      border-radius: 12px;
      color: var(--gray-color);
      font-weight: 500;
      transition: background-color 0.25s ease, color 0.25s ease, box-shadow 0.25s ease;
      border: 1px solid transparent;
    }

    .crm-nav-link svg {
      width: 20px;
      height: 20px;
      stroke-width: 1.8;
      transition: transform 0.25s ease;
    }

    .crm-nav-link:hover {
      background-color: rgba(67, 100, 247, 0.08);
    }

    .crm-nav-link:hover svg {
      transform: translateX(2px);
    }

    .crm-nav-link.is-active {
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
      color: var(--white-color);
      box-shadow: 0 10px 24px rgba(0, 82, 212, 0.2);
    }

    .crm-nav-link.is-active svg {
      stroke: var(--white-color);
      transform: translateX(2px);
    }

    .crm-sidebar-footer {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .crm-main {
      min-height: calc(100vh - var(--header-height));
      flex-grow: 1;
      padding: 32px 40px;
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .crm-page {
      display: none;
      flex-direction: column;
      gap: 24px;
    }

    .crm-page.is-active {
      display: flex;
    }

    .crm-page-header {
      margin-bottom: 8px;
    }

    .crm-page-title {
      font-size: clamp(2rem, 2.4vw, 2.35rem);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .crm-page-subtitle {
      font-size: 1.05rem;
      color: var(--gray-color);
      max-width: 720px;
    }

    .crm-card {
      background: var(--white-color);
      border-radius: var(--border-radius);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
      border: 1px solid var(--border-color);
      padding: 25px;
    }

    .crm-page-filter {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .crm-page-filter label {
      font-weight: 600;
    }

    .crm-page-filter select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background-color: var(--white-color);
      font-size: 1rem;
    }

    /* Dashboard */
    .crm-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 25px;
      margin-bottom: 25px;
    }

    .crm-stat-card {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px;
      border-radius: var(--border-radius);
      background-color: var(--white-color);
      border: 1px solid var(--border-color);
    }

    .crm-stat-icon {
      padding: 15px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .crm-stat-icon svg {
      width: 28px;
      height: 28px;
    }

    .crm-stat-card .crm-stat-value {
      font-size: 2rem;
      font-weight: 700;
    }

    .crm-stat-card .crm-stat-label {
      color: var(--gray-color);
      font-size: 0.9rem;
    }

    .crm-stat-card[data-variant="requests"] .crm-stat-icon { background-color: var(--crm-request-bg); color: var(--crm-request-color); }
    .crm-stat-card[data-variant="visits"] .crm-stat-icon { background-color: var(--crm-visit-request-bg); color: var(--crm-visit-request-color); }
    .crm-stat-card[data-variant="bookings"] .crm-stat-icon { background-color: var(--crm-prebooked-bg); color: var(--crm-prebooked-color); }
    .crm-stat-card[data-variant="venues"] .crm-stat-icon { background-color: var(--crm-booked-bg); color: var(--primary-color); }
    .crm-stat-card[data-variant="visits-total"] .crm-stat-icon { background-color: rgba(0, 82, 212, 0.12); color: var(--primary-color); }
    .crm-stat-card[data-variant="visits-month"] .crm-stat-icon { background-color: rgba(67, 100, 247, 0.12); color: var(--secondary-color); }

    .crm-dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 25px;
    }
    
    .crm-dashboard-grid--charts {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      margin-top: 15px;
    }
    
    .crm-chart {
      min-height: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .crm-chart svg {
      width: 100%;
      height: 100%;
    }
    
    .crm-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .crm-card-title {
      font-size: 1.4rem;
      font-weight: 600;
    }
    
    /* NOU: Stiluri pentru graficele de ocupare */
    .crm-occupancy-chart {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-around;
      align-items: center;
      min-height: 260px;
    }

    .crm-donut-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      min-width: 120px;
    }

    .crm-donut {
      --occupied-deg: 0deg;
      --occupied-color: var(--primary-color);
      --available-color: rgba(0, 82, 212, 0.08);
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: conic-gradient(var(--occupied-color) var(--occupied-deg), var(--available-color) 0);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      color: var(--dark-color);
      font-weight: 700;
    }

    .crm-donut::after { content: attr(data-percentage) '%'; font-size: 1.1rem; }
    .crm-donut-label { font-size: 0.9rem; color: var(--gray-color); text-align: center; }

    .crm-notification-list {
      display: flex;
      flex-direction: column;
    }

    .crm-notification {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px 0;
      border-bottom: 1px solid var(--border-color);
    }

    .crm-notification:last-child {
      border-bottom: none;
    }

    .crm-notification-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .crm-notification-icon svg {
      width: 18px;
      height: 18px;
    }

    .crm-notification-timestamp {
      font-size: 0.85rem;
      color: var(--gray-color);
      margin-top: 4px;
    }

    /* Calendar */
    .crm-calendar {
      flex-grow: 1;
      width: 100%;
    }

    .crm-calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .crm-calendar-header h2 {
      font-size: 1.5rem;
    }

    .crm-calendar-nav-button {
      background: none;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      width: 36px;
      height: 36px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .crm-calendar-nav-button:hover {
      background-color: var(--light-gray-color);
    }

    .crm-calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: minmax(140px, auto);
    }

    .crm-calendar-day-name {
      text-align: center;
      font-weight: 600;
      color: var(--gray-color);
      padding: 10px 0;
    }

    .crm-calendar-date {
      border: 1px solid var(--border-color);
      padding: 8px;
      font-weight: 500;
      background-color: var(--white-color);
      transition: background-color 0.2s ease;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .crm-calendar-date[data-outside="true"] {
      background-color: #fcfcfc;
      color: #ccc;
    }
    
    .crm-calendar-date.is-unavailable {
        background-color: var(--crm-unavailable-bg);
        color: var(--crm-unavailable-color);
        text-decoration: line-through;
    }

    .crm-calendar-date .crm-day-number {
      margin-bottom: 5px;
    }

    .crm-calendar-event {
      font-size: 0.8rem;
      padding: 4px 6px;
      border-radius: 4px;
      color: var(--dark-color);
      display: block;
      line-height: 1.35;
      word-break: break-word;
      border-left: 3px solid;
    }
    
    .crm-calendar-event + .crm-calendar-event {
      margin-top: 4px;
    }
    
    .crm-calendar-event[data-variant="booked"] { background-color: var(--crm-booked-bg); border-color: var(--crm-booked-color); }
    .crm-calendar-event[data-variant="prebooked"] { background-color: var(--crm-prebooked-bg); border-color: var(--crm-prebooked-color); }
    .crm-calendar-event[data-variant="request"] { background-color: var(--crm-request-bg); border-color: var(--crm-request-color); }
    .crm-calendar-event[data-variant="visit"] { background-color: var(--crm-visit-request-bg); border-color: var(--crm-visit-request-color); }
    .crm-calendar-event[data-variant="unavailable"] { background-color: var(--crm-unavailable-bg); border-color: var(--crm-unavailable-color); color: var(--crm-unavailable-color); text-decoration: line-through; }
    
    .crm-availability-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 16px 0;
    }
    
    .crm-availability-legend span {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      background-color: var(--light-gray-color);
      color: var(--dark-color);
      font-weight: 600;
    }

    .crm-availability-legend span::before {
      content: '';
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: currentColor;
    }

    .crm-availability-legend span[data-variant="booked"] { color: var(--crm-booked-color); }
    .crm-availability-legend span[data-variant="prebooked"] { color: var(--crm-prebooked-color); }
    .crm-availability-legend span[data-variant="request"] { color: var(--crm-request-color); }
    .crm-availability-legend span[data-variant="visit"] { color: var(--crm-visit-request-color); }
    .crm-availability-legend span[data-variant="unavailable"] { color: var(--crm-unavailable-color); }
    
    /* Tables */
    .crm-table-container {
      overflow-x: auto;
    }

    .crm-data-table {
      width: 100%;
      border-collapse: collapse;
      text-align: left;
    }

    .crm-data-table th,
    .crm-data-table td {
      padding: 15px;
      border-bottom: 1px solid var(--border-color);
    }

    .crm-data-table th {
      font-weight: 600;
      color: var(--gray-color);
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    .crm-data-table td {
      font-weight: 500;
    }

    .crm-data-table .crm-empty-row td {
      text-align: center;
      color: var(--gray-color);
    }

    .crm-status-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: capitalize;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .crm-status-badge[data-status="confirmed"],
    .crm-status-badge[data-status="published"] { background-color: var(--crm-booked-bg); color: var(--crm-booked-color); }
    .crm-status-badge[data-status="pending"] { background-color: var(--crm-request-bg); color: #856404; }
    .crm-status-badge[data-status="visit-pending"] { background-color: var(--crm-visit-request-bg); color: var(--crm-visit-request-color); }
    .crm-status-badge[data-status="pre-booked"] { background-color: var(--crm-prebooked-bg); color: var(--crm-prebooked-color); }
    .crm-status-badge[data-status="declined"] { background-color: rgba(220, 53, 69, 0.12); color: #dc3545; }

    .crm-action-buttons {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .crm-action-button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .crm-action-button:hover {
      background-color: var(--light-gray-color);
    }

    .crm-action-button svg {
      width: 20px;
      height: 20px;
    }

    .crm-action-button[data-action="confirm"] svg { stroke: var(--crm-prebooked-color); }
    .crm-action-button[data-action="decline"] svg { stroke: #dc3545; }

    /* Venues */
    .crm-venue-status {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px;
      border: 1px dashed var(--border-color);
      border-radius: var(--border-radius);
      margin-bottom: 25px;
    }

    .crm-venue-status-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--crm-request-bg);
      color: var(--crm-request-color);
    }

    #venues-list {
      display: grid;
      gap: 20px;
    }
    
    .result-card { /* Re-used from general styles for venue cards */
        background: var(--white-color);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        display: flex;
        gap: 20px;
        align-items: stretch;
        overflow: hidden;
    }
    
    .result-image {
        flex: 0 0 260px;
        min-height: 220px;
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
    }

    .result-details {
        padding: 20px;
        display: flex;
        flex-direction: column;
        flex: 1;
    }
    .result-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dark-color);
    }
    .result-location {
        color: var(--gray-color);
        font-size: 0.95rem;
    }

    .crm-venue-card .result-details {
      gap: 16px;
    }

    .crm-venue-meta {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .crm-venue-actions {
      margin-top: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .crm-venue-card .crm-status-badge {
      font-size: 0.75rem;
      padding: 5px 10px;
    }

    /* Availability */
    .crm-availability-scheduler {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .crm-scheduler-placeholder {
      padding: 24px;
      border: 1px dashed var(--border-color);
      border-radius: var(--border-radius);
      background-color: #fafbff;
      color: var(--gray-color);
      text-align: center;
    }

    .crm-day-schedule {
      background-color: #fafbff;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 15px;
    }

    .crm-day-schedule h4 {
      margin-bottom: 15px;
      font-weight: 600;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
    }

    .crm-time-slots {
      min-height: 50px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .crm-time-slot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--white-color);
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      font-size: 0.9rem;
    }

    .crm-remove-slot-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #dc3545;
      font-weight: 700;
    }

    .crm-add-slot-form {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    .crm-add-slot-form input[type="time"] {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-family: inherit;
    }

    .crm-add-slot-btn {
      background-color: var(--primary-color);
      color: var(--white-color);
      border: none;
      border-radius: 6px;
      padding: 0 15px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Dialog / Modal */
    .crm-dialog-overlay {
      position: fixed;
      inset: 0;
      background: rgba(26, 32, 44, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 999;
    }

    .crm-dialog-overlay.is-hidden {
      display: none;
    }

    .crm-dialog {
      background: var(--white-color);
      border-radius: var(--border-radius);
      padding: 32px;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 20px 45px rgba(15, 35, 95, 0.18);
    }

    .crm-dialog h2 {
      font-size: 1.5rem;
      margin-bottom: 12px;
    }

    .crm-dialog p {
      color: var(--gray-color);
      margin-bottom: 24px;
    }

    .crm-dialog .cta-button {
      width: 100%;
    }

    /* Settings */
    .crm-form-group {
      margin-bottom: 20px;
    }

    .crm-form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .crm-form-group input,
    .crm-form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      background-color: var(--white-color);
    }
    
    .crm-form-group input:focus,
    .crm-form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px var(--shadow-color);
    }

    .crm-card-footer {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      text-align: right;
    }

    .crm-form-grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
    }
    
    .crm-toggle-switch-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
    }

    .crm-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
    }
    
    .crm-switch input { opacity: 0; width: 0; height: 0; }

    .crm-slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 28px;
    }

    .crm-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    .crm-switch input:checked + .crm-slider { background-color: var(--primary-color); }
    .crm-switch input:checked + .crm-slider:before { transform: translateX(22px); }


    /* Responsive */
    @media (max-width: 1200px) {
      .crm-dashboard-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 1024px) {
      main.crm-shell {
        padding-left: 0;
      }

      .crm-sidebar {
        position: static;
        width: 100%;
        max-height: none;
        box-shadow: none;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        flex-direction: column;
      }

      .crm-sidebar-nav {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 12px;
      }

      .crm-nav-link {
        padding: 10px 14px;
      }

      .crm-main {
        width: 100%;
        padding: 36px 28px 60px;
      }
      
      .result-card, .crm-venue-card {
        flex-direction: column;
      }
      
      .result-image {
        width: 100%;
        flex: none;
        height: 220px;
      }

      .crm-venue-actions {
        width: 100%;
        justify-content: flex-start;
      }

      .crm-venue-actions .cta-button,
      .crm-venue-actions .secondary-cta-button,
      .crm-venue-actions .crm-ghost-button {
        flex: 1 1 auto;
      }
    }

    @media (max-width: 768px) {
      .crm-sidebar {
        padding: 24px 20px;
      }

      .crm-sidebar-nav {
        overflow-x: auto;
        padding-bottom: 6px;
        gap: 10px;
      }

      .crm-nav-link {
        flex: 0 0 auto;
        white-space: nowrap;
      }

      .crm-main {
        padding: 32px 20px 52px;
        gap: 28px;
      }
    }
  </style>
</head>
<body>
  <!-- Header will be injected by main.js -->
  <!-- Mobile Menu will be injected by main.js -->
  <main class="crm-shell" data-page="owner-crm">
    <div class="crm-app">
    <aside class="crm-sidebar" aria-label="Navigare CRM">
      <div class="crm-sidebar-inner">
        <div class="crm-sidebar-header">
          <a href="#" class="crm-sidebar-logo">ouidoEvents CRM</a>
        </div>
        <nav class="crm-sidebar-nav">
          <a href="#dashboard" class="crm-nav-link is-active" data-crm-nav data-page-target="dashboard">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span>Dashboard</span>
          </a>
          <a href="#bookings" class="crm-nav-link" data-crm-nav data-page-target="bookings">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            <span>Solicitări eveniment</span>
          </a>
          <a href="#visits" class="crm-nav-link" data-crm-nav data-page-target="visits">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span>Programări vizionări</span>
          </a>
          <a href="#venues" class="crm-nav-link" data-crm-nav data-page-target="venues">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            <span>Locațiile mele</span>
          </a>
          <a href="#availability" class="crm-nav-link" data-crm-nav data-page-target="availability">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span>Disponibilitate</span>
          </a>
          <a href="#settings" class="crm-nav-link" data-crm-nav data-page-target="settings">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            <span>Setări</span>
          </a>
        </nav>
        <div class="crm-sidebar-footer">
          <a href="#" class="crm-nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
            <span>Deconectare</span>
          </a>
        </div>
      </div>
    </aside>

    <section class="crm-main" aria-label="Conținut CRM">
      <section class="crm-page is-active" id="dashboard" data-page-section="dashboard">
        <header class="crm-page-header">
          <h1 class="crm-page-title">Panou general</h1>
          <p class="crm-page-subtitle">Monitorizează performanța locațiilor tale într-un singur loc.</p>
        </header>

        <div class="crm-stats-grid">
          <article class="crm-stat-card" data-variant="venues">
            <div class="crm-stat-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            </div>
            <div>
              <p class="crm-stat-value" id="total-venues-stat">0</p>
              <p class="crm-stat-label">Locații listate</p>
            </div>
          </article>
          <article class="crm-stat-card" data-variant="bookings">
            <div class="crm-stat-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <div>
              <p class="crm-stat-value" id="active-venues-stat">0</p>
              <p class="crm-stat-label">Locații active</p>
            </div>
          </article>
          <article class="crm-stat-card" data-variant="requests">
            <div class="crm-stat-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22 6 12 13 2 6"></polyline></svg>
            </div>
            <div>
              <p class="crm-stat-value" id="event-requests-stat">0</p>
              <p class="crm-stat-label">Solicitări eveniment</p>
            </div>
          </article>
          <article class="crm-stat-card" data-variant="visits">
            <div class="crm-stat-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
            </div>
            <div class="crm-stat-info">
              <p class="crm-stat-value" id="visit-requests-stat">0</p>
              <p class="crm-stat-label">Vizionări în așteptare</p>
            </div>
          </article>
          <article class="crm-stat-card" data-variant="visits-total">
            <div class="crm-stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            </div>
            <div class="crm-stat-info">
                <p class="crm-stat-value" id="total-visits-stat">0</p>
                <p class="crm-stat-label">Număr total vizite</p>
            </div>
          </article>
          <article class="crm-stat-card" data-variant="visits-month">
              <div class="crm-stat-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
              </div>
              <div class="crm-stat-info">
                  <p class="crm-stat-value" id="monthly-visits-stat">0</p>
                  <p class="crm-stat-label">Vizionări luna curentă</p>
              </div>
          </article>
        </div>

        <div class="crm-dashboard-grid">
          <section class="crm-card">
            <div class="crm-card-header">
              <h2 class="crm-card-title">Activitate recentă</h2>
            </div>
            <div class="crm-notification-list">
              <article class="crm-notification">
                <div class="crm-notification-icon" style="background-color: var(--crm-visit-request-bg); color: var(--crm-visit-request-color);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </div>
                <div>
                  <p><strong>Cerere nouă de vizită</strong> pentru <strong>The Grand Ballroom</strong> din partea Mariei Stan.</p>
                  <p class="crm-notification-timestamp">Acum 5 minute</p>
                </div>
              </article>
              <article class="crm-notification">
                <div class="crm-notification-icon" style="background-color: var(--crm-request-bg); color: var(--crm-request-color);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22 6 12 13 2 6"></polyline></svg>
                </div>
                <div>
                  <p><strong>Solicitare de eveniment</strong> pentru <strong>Lakeside Manor</strong> din partea lui Andrei Popescu.</p>
                  <p class="crm-notification-timestamp">Acum 15 minute</p>
                </div>
              </article>
              <article class="crm-notification">
                <div class="crm-notification-icon" style="background-color: var(--crm-prebooked-bg); color: var(--crm-prebooked-color);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                </div>
                <div>
                  <p><strong>Pre-rezervare confirmată</strong> pentru "Corporate Gala" la <strong>The Grand Ballroom</strong>.</p>
                  <p class="crm-notification-timestamp">Acum 2 ore</p>
                </div>
              </article>
            </div>
          </section>
          <section class="crm-card">
            <div class="crm-card-header">
              <h2 class="crm-card-title">Evenimente viitoare</h2>
            </div>
            <p>Următoarele evenimente confirmate vor fi afișate aici pentru o planificare rapidă.</p>
          </section>
        </div>
        <div class="crm-dashboard-grid crm-dashboard-grid--charts">
            <section class="crm-card">
              <div class="crm-card-header">
                <h2 class="crm-card-title">Evoluție vizite pe ultimele 12 luni</h2>
              </div>
              <div class="crm-chart" id="visits-trend-chart" role="img" aria-label="Grafic evoluție vizite"></div>
            </section>
            <section class="crm-card">
              <div class="crm-card-header">
                <h2 class="crm-card-title">Rata de ocupare</h2>
              </div>
              <div id="occupancy-pie-chart"></div>
            </section>
        </div>
      </section>

      <section class="crm-page" id="bookings" data-page-section="bookings">
        <header class="crm-page-header">
          <h1 class="crm-page-title">Solicitări eveniment</h1>
          <p class="crm-page-subtitle">Revizuiește toate cererile primite și actualizează starea acestora.</p>
        </header>
        <div class="crm-page-filter">
          <label for="bookings-venue-filter">Filtrează după locație:</label>
          <select id="bookings-venue-filter"></select>
        </div>
        <section class="crm-card">
          <div class="crm-table-container">
            <table class="crm-data-table">
              <thead>
                <tr>
                  <th>Client</th>
                  <th>Locație</th>
                  <th>Tip eveniment</th>
                  <th>Dată</th>
                  <th>Invitați</th>
                  <th>Stare</th>
                  <th>Acțiuni</th>
                </tr>
              </thead>
              <tbody id="bookings-table-body"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section class="crm-page" id="visits" data-page-section="visits">
        <header class="crm-page-header">
          <h1 class="crm-page-title">Cereri de vizită</h1>
          <p class="crm-page-subtitle">Gestionează cererile de vizionare pentru fiecare locație.</p>
        </header>
        <div class="crm-page-filter">
          <label for="visits-venue-filter">Filtrează după locație:</label>
          <select id="visits-venue-filter"></select>
        </div>
        <section class="crm-card">
          <div class="crm-table-container">
            <table class="crm-data-table">
              <thead>
                <tr>
                  <th>Client</th>
                  <th>Locație</th>
                  <th>Dată</th>
                  <th>Oră</th>
                  <th>Stare</th>
                  <th>Acțiuni</th>
                </tr>
              </thead>
              <tbody id="visits-table-body"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section class="crm-page" id="venues" data-page-section="venues">
        <header class="crm-page-header">
          <h1 class="crm-page-title">Locațiile mele</h1>
          <p class="crm-page-subtitle">Actualizează detaliile spațiilor listate și adaugă locații noi.</p>
        </header>
        <div class="crm-card crm-venue-status">
          <div class="crm-venue-status-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
          </div>
          <div>
            <h3>Propune o locație nouă</h3>
            <p>Completează formularul dedicat pentru a crește vizibilitatea portofoliului tău.</p>
          </div>
          <a href="#" class="cta-button" style="margin-left: auto;">Adaugă locație</a>
        </div>
        <div id="venues-list"></div>
      </section>

      <section class="crm-page" id="availability" data-page-section="availability">
        <header class="crm-page-header">
          <h1 class="crm-page-title" id="availability-page-title">Disponibilitate locație</h1>
          <div class="crm-page-filter">
            <label for="availability-venue-selector">Selectează locația:</label>
            <select id="availability-venue-selector"></select>
          </div>
        </header>
        <section class="crm-card">
          <div class="crm-card-header">
            <h2 class="crm-card-title">Blochează date pentru evenimente</h2>
          </div>
          <p>Selectează zilele în care locația nu poate găzdui evenimente (ex. renovări, evenimente private).</p>
          <div class="crm-availability-legend" aria-label="Legendă disponibilitate">
            <span data-variant="booked">Confirmat</span>
            <span data-variant="prebooked">Pre-rezervat</span>
            <span data-variant="request">Solicitare</span>
            <span data-variant="visit">Vizită</span>
            <span data-variant="unavailable">Indisponibil</span>
          </div>
          <div id="availability-calendar-container" class="crm-calendar"></div>
        </section>
        <section class="crm-card">
          <div class="crm-card-header">
            <h2 class="crm-card-title">Program standard pentru vizite</h2>
          </div>
          <p>Definește intervalele orare pentru fiecare zi în care pot avea loc vizite.</p>
          <div class="crm-availability-scheduler"></div>
        </section>
      </section>

      <section class="crm-page" id="settings" data-page-section="settings">
        <header class="crm-page-header">
          <h1 class="crm-page-title">Setări cont</h1>
          <p class="crm-page-subtitle">Actualizează informațiile personale și datele companiei tale.</p>
        </header>

        <section class="crm-card">
            <div class="crm-card-header">
              <h2 class="crm-card-title">Preferințe generale</h2>
            </div>
            <div class="crm-toggle-switch-group">
              <label for="auto-confirm">Confirmare automată a disponibilității</label>
              <label class="crm-switch">
                <input type="checkbox" id="auto-confirm">
                <span class="crm-slider"></span>
              </label>
            </div>
        </section>

        <section class="crm-card">
          <div class="crm-card-header">
            <h2 class="crm-card-title">Profil proprietar</h2>
          </div>
          <form>
            <div class="crm-form-grid-2">
              <div class="crm-form-group">
                <label for="owner-name">Prenume</label>
                <input type="text" id="owner-name" value="Alexandru">
              </div>
              <div class="crm-form-group">
                <label for="owner-surname">Nume</label>
                <input type="text" id="owner-surname" value="Popa">
              </div>
            </div>
            <div class="crm-form-group">
                <label for="owner-email">Email</label>
                <input type="email" id="owner-email" value="alex.popa@grandballroom.ro" readonly>
            </div>
            <div class="crm-form-group">
                <label for="owner-phone">Telefon</label>
                <input type="tel" id="owner-phone" value="+40 712 345 678">
            </div>
            <div class="crm-card-footer">
              <button type="submit" class="cta-button">Salvează profilul</button>
            </div>
          </form>
        </section>

        <section class="crm-card">
          <div class="crm-card-header">
            <h2 class="crm-card-title">Date companie</h2>
          </div>
          <form>
            <div class="crm-form-group">
              <label for="company-name">Denumire companie</label>
              <input type="text" id="company-name" value="The Grand Ballroom SRL">
            </div>
            <div class="crm-form-group">
              <label for="company-cui">CUI</label>
              <input type="text" id="company-cui" value="RO12345678">
            </div>
            <div class="crm-form-group">
              <label for="company-address">Adresă</label>
              <input type="text" id="company-address" value="Str. Principală, nr. 1, București">
            </div>
            <div class="crm-card-footer">
              <button type="submit" class="cta-button">Salvează datele</button>
            </div>
          </form>
        </section>
      </section>
    </section>
    </div>
  </main>
  <!-- Footer is intentionally omitted on the CRM page -->

  <script src="main.js"></script>

  <script type="module">
    // --- MOCK DATA (In a real app, this would come from an API) ---
    const venues = [
        { id: 1, name: 'The Grand Ballroom', location: 'București, România', status: 'Published', imageUrl: 'https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?auto=format&fit=crop&w=800&q=80' },
        { id: 2, name: 'Lakeside Manor', location: 'Cluj-Napoca, România', status: 'Pending', imageUrl: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=80' }
    ];
    
    let eventRequests = [
        { id: 1, venueId: 2, client: 'Andrei Popescu', eventType: 'Nuntă', date: '2025-10-25', guests: 150, status: 'pending' },
        { id: 2, venueId: 1, client: 'Tech Solutions Inc.', eventType: 'Eveniment Corporate', date: '2025-11-12', guests: 200, status: 'pre-booked' },
        { id: 3, venueId: 1, client: 'Elena Ionescu', eventType: 'Petrecere Privată', date: '2025-10-18', guests: 80, status: 'confirmed' }
    ];
    
    let visitRequests = [
        { id: 1, venueId: 1, client: 'Maria Stan', date: '2025-10-10', time: '14:00', status: 'pending' },
        { id: 2, venueId: 1, client: 'George Dobre', date: '2025-10-09', time: '11:00', status: 'confirmed' },
        { id: 3, venueId: 2, client: 'Ana Diaconu', date: '2025-10-11', time: '16:30', status: 'pending' }
    ];
    
    const monthlyVisitTrend = [
        { label: 'Ian', value: 12 }, { label: 'Feb', value: 15 }, { label: 'Mar', value: 18 }, { label: 'Apr', value: 16 }, 
        { label: 'Mai', value: 19 }, { label: 'Iun', value: 21 }, { label: 'Iul', value: 24 }, { label: 'Aug', value: 26 }, 
        { label: 'Sep', value: 28 }, { label: 'Oct', value: 30 }, { label: 'Nov', value: 27 }, { label: 'Dec', value: 32 }
    ];
    
    const occupancyForecast = [
        { month: 'Octombrie', occupiedDays: 18, totalDays: 31 },
        { month: 'Noiembrie', occupiedDays: 20, totalDays: 30 },
        { month: 'Decembrie', occupiedDays: 16, totalDays: 31 }
    ];
    
    const availabilityData = {
        1: { blockedDates: ['2025-11-15'], visitSlots: { 'Luni': [{ start: '10:00', end: '12:00' }, { start: '14:00', end: '17:00' }], 'Miercuri': [{ start: '10:00', end: '17:00' }] } },
        2: { blockedDates: ['2025-12-24', '2025-12-25'], visitSlots: { 'Marți': [{ start: '09:00', end: '13:00' }] } }
    };

    const EVENT_STATUS_VARIANTS = { confirmed: 'booked', 'pre-booked': 'prebooked', pending: 'request', 'visit-pending': 'visit', declined: 'unavailable' };
    const CALENDAR_DAY_NAMES = ['Dum', 'Lun', 'Mar', 'Mie', 'Joi', 'Vin', 'Sâm'];
    const WEEK_DAYS = ['Duminică', 'Luni', 'Marți', 'Miercuri', 'Joi', 'Vineri', 'Sâmbătă'];

    function initOwnerCrmPage() {
      const crmApp = document.querySelector('.crm-app');
      if (!crmApp) return;

      let activeAvailabilityVenueId = venues[0]?.id ?? null;
      let availabilitySelection = 'all';

      const navLinks = Array.from(document.querySelectorAll('.crm-nav-link'));
      const crmPages = Array.from(document.querySelectorAll('.crm-page'));
      const schedulerContainer = document.querySelector('.crm-availability-scheduler');
      const availabilityDialog = document.getElementById('availability-dialog');
      const availabilityDialogClose = availabilityDialog?.querySelector('[data-dialog-close]');

      function ensureVenueAvailability(venueId) {
        if (!availabilityData[venueId]) {
          availabilityData[venueId] = { blockedDates: [], visitSlots: {} };
        }
      }

      function showPage(pageId, { updateHash = true } = {}) {
        crmPages.forEach(page => page.classList.toggle('is-active', page.dataset.pageSection === pageId));
        navLinks.forEach(link => link.classList.toggle('is-active', link.dataset.pageTarget === pageId));

        if (updateHash) window.location.hash = pageId;
        if (pageId === 'availability') updateAvailabilityPage();
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function populateVenueSelector(selectorId, { includeAllOption = false } = {}) {
        const selector = document.getElementById(selectorId);
        if (!selector) return;
        
        const options = venues.map(venue => `<option value="${venue.id}">${venue.name}</option>`).join('');
        selector.innerHTML = includeAllOption ? `<option value="all">Toate locațiile</option>${options}` : options;

        if (selectorId === 'availability-venue-selector') {
          selector.value = availabilitySelection === 'all' ? 'all' : String(activeAvailabilityVenueId);
        }
      }

      function renderDashboardStats() {
        document.getElementById('total-venues-stat').textContent = venues.length;
        document.getElementById('active-venues-stat').textContent = venues.filter(v => v.status === 'Published').length;
        document.getElementById('event-requests-stat').textContent = eventRequests.filter(r => r.status === 'pending').length;
        document.getElementById('visit-requests-stat').textContent = visitRequests.filter(r => r.status === 'pending').length;
        document.getElementById('total-visits-stat').textContent = visitRequests.length;
        
        const now = new Date();
        const currentMonthKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        document.getElementById('monthly-visits-stat').textContent = visitRequests.filter(r => r.date.startsWith(currentMonthKey)).length;
      }

      function renderVenuesPage() {
        const listContainer = document.getElementById('venues-list');
        if (!listContainer) return;

        listContainer.innerHTML = venues.map(venue => {
          const badgeStatus = venue.status === 'Published' ? 'published' : 'pending';
          const badgeLabel = venue.status === 'Published' ? 'Publicată' : 'În așteptare';
          return `
            <article class="result-card crm-venue-card">
              <div class="result-image" style="background-image: url('${venue.imageUrl}');"></div>
              <div class="result-details">
                <div class="crm-venue-meta">
                  <span class="crm-status-badge" data-status="${badgeStatus}">${badgeLabel}</span>
                  <span class="result-location">${venue.location}</span>
                </div>
                <h3>${venue.name}</h3>
                <div class="crm-venue-actions">
                  <a href="#availability" class="cta-button" data-crm-nav data-page-target="availability" data-venue-id="${venue.id}">Disponibilitate</a>
                  <button type="button" class="secondary-cta-button" data-venue-id="${venue.id}">Editează</button>
                  <button type="button" class="crm-ghost-button" data-venue-id="${venue.id}">Pauză</button>
                </div>
              </div>
            </article>`;
        }).join('');
      }
      
      function renderVisitsTrendChart() {
        const container = document.getElementById('visits-trend-chart');
        if (!container) return;

        container.innerHTML = '';
        if (monthlyVisitTrend.length < 2) {
          container.innerHTML = '<p style="text-align:center; color: var(--muted-color);">Date insuficiente pentru grafic.</p>';
          return;
        }

        const svgNs = 'http://www.w3.org/2000/svg';
        const svg = document.createElementNS(svgNs, 'svg');
        const width = 600;
        const height = 260;
        const padding = { top: 20, right: 20, bottom: 30, left: 30 };
        const chartWidth = width - padding.left - padding.right;
        const chartHeight = height - padding.top - padding.bottom;

        svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
        svg.style.fontFamily = 'inherit';

        const maxValue = Math.max(...monthlyVisitTrend.map(item => item.value)) * 1.1; // Add 10% buffer

        const points = monthlyVisitTrend.map((item, index) => {
          const x = padding.left + (index / (monthlyVisitTrend.length - 1)) * chartWidth;
          const y = padding.top + chartHeight - (item.value / maxValue) * chartHeight;
          return { x, y, label: item.label };
        });

        // Gradient definition
        const defs = document.createElementNS(svgNs, 'defs');
        const linearGradient = document.createElementNS(svgNs, 'linearGradient');
        linearGradient.id = 'area-gradient';
        linearGradient.setAttribute('x1', '0%');
        linearGradient.setAttribute('y1', '0%');
        linearGradient.setAttribute('x2', '0%');
        linearGradient.setAttribute('y2', '100%');
        linearGradient.innerHTML = `
          <stop offset="0%" style="stop-color:rgba(0, 82, 212, 0.2)" />
          <stop offset="100%" style="stop-color:rgba(0, 82, 212, 0)" />
        `;
        defs.appendChild(linearGradient);
        svg.appendChild(defs);

        // Area path
        const areaPath = document.createElementNS(svgNs, 'path');
        const areaPoints = `M${points[0].x},${height - padding.bottom} ` + points.map(p => `L${p.x},${p.y}`).join(' ') + ` L${points[points.length - 1].x},${height - padding.bottom} Z`;
        areaPath.setAttribute('d', areaPoints);
        areaPath.setAttribute('fill', 'url(#area-gradient)');
        svg.appendChild(areaPath);

        // Line path
        const polyline = document.createElementNS(svgNs, 'polyline');
        polyline.setAttribute('points', points.map(p => `${p.x},${p.y}`).join(' '));
        polyline.setAttribute('fill', 'none');
        polyline.setAttribute('stroke', 'var(--primary-color)');
        polyline.setAttribute('stroke-width', '3');
        polyline.setAttribute('stroke-linecap', 'round');
        polyline.setAttribute('stroke-linejoin', 'round');
        svg.appendChild(polyline);

        // Points and labels
        points.forEach(point => {
          const circle = document.createElementNS(svgNs, 'circle');
          circle.setAttribute('cx', point.x);
          circle.setAttribute('cy', point.y);
          circle.setAttribute('r', '5');
          circle.setAttribute('fill', 'var(--primary-color)');
          svg.appendChild(circle);

          const text = document.createElementNS(svgNs, 'text');
          text.setAttribute('x', point.x);
          text.setAttribute('y', height - padding.bottom + 18);
          text.setAttribute('text-anchor', 'middle');
          text.setAttribute('font-size', '12');
          text.setAttribute('fill', 'var(--muted-color)');
          text.textContent = point.label;
          svg.appendChild(text);
        });

        container.appendChild(svg);
      }

      function renderOccupancyChart() {
        const container = document.getElementById('occupancy-pie-chart');
        if (!container) return;

        container.innerHTML = '';
        if (!occupancyForecast.length) {
          container.innerHTML = '<p style="text-align:center; color: var(--muted-color);">Date insuficiente.</p>';
          return;
        }

        const wrapper = document.createElement('div');
        wrapper.className = 'crm-occupancy-chart';
        const colors = ['var(--primary-color)', 'var(--secondary-color)', '#28a745'];

        occupancyForecast.forEach((entry, index) => {
          const ratio = entry.totalDays > 0 ? entry.occupiedDays / entry.totalDays : 0;
          const percentage = Math.round(ratio * 100);
          const color = colors[index % colors.length];

          const donutCard = document.createElement('div');
          donutCard.className = 'crm-donut-card';

          const donut = document.createElement('div');
          donut.className = 'crm-donut';
          donut.dataset.percentage = percentage;
          donut.style.setProperty('--occupied-color', color);
          donut.style.setProperty('--occupied-deg', `${(ratio * 360).toFixed(2)}deg`);

          donutCard.innerHTML = `<p class="crm-donut-label">${entry.month}</p>`;
          donutCard.prepend(donut);
          wrapper.appendChild(donutCard);
        });
        container.appendChild(wrapper);
      }

      function formatStatusBadge(status) {
        const normalized = status.toLowerCase();
        let label = status.replace('-', ' ');
        if (normalized === 'pending') label = 'În așteptare';
        else if (normalized === 'pre-booked') label = 'Pre-rezervat';
        else if (normalized === 'confirmed') label = 'Confirmat';
        else if (normalized === 'declined') label = 'Respins';
        return `<span class="crm-status-badge" data-status="${normalized}">${label}</span>`;
      }

      function renderRequestsTable(tableBodyId, requests, venueFilterId) {
        const tableBody = document.getElementById(tableBodyId);
        const filter = document.getElementById(venueFilterId);
        if (!tableBody || !filter) return;
        
        const filtered = requests.filter(r => filter.value === 'all' || String(r.venueId) === filter.value);
        if (filtered.length === 0) {
            const colspan = tableBody.closest('table').querySelector('thead').rows[0].cells.length;
            tableBody.innerHTML = `<tr><td colspan="${colspan}" style="text-align:center;">Nicio solicitare.</td></tr>`;
            return;
        }

        tableBody.innerHTML = filtered.map(req => {
            const venueName = venues.find(v => v.id === req.venueId)?.name ?? 'N/A';
            const actions = req.status === 'pending' ?
                `<div class="crm-action-buttons">
                    <button class="crm-action-button" data-action="confirm" data-request-type="${tableBodyId}" data-request-id="${req.id}" title="Confirmă"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></button>
                    <button class="crm-action-button" data-action="decline" data-request-type="${tableBodyId}" data-request-id="${req.id}" title="Respinge"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>` : '';

            if (tableBodyId === 'bookings-table-body') {
                return `<tr>
                    <td>${req.client}</td>
                    <td>${venueName}</td>
                    <td>${req.eventType}</td>
                    <td>${req.date}</td>
                    <td>${req.guests}</td>
                    <td>${formatStatusBadge(req.status)}</td>
                    <td>${actions}</td>
                </tr>`;
            } else { // visits-table-body
                const status = req.status === 'pending' ? 'visit-pending' : req.status;
                let visitLabel = req.status.charAt(0).toUpperCase() + req.status.slice(1);
                if (status === 'visit-pending') visitLabel = 'În așteptare';
                if (status === 'confirmed') visitLabel = 'Confirmată';
                if (status === 'declined') visitLabel = 'Respinsă';
                
                return `<tr>
                    <td>${req.client}</td>
                    <td>${venueName}</td>
                    <td>${req.date}</td>
                    <td>${req.time}</td>
                    <td><span class="crm-status-badge" data-status="${status}">${visitLabel}</span></td>
                    <td>${actions}</td>
                </tr>`;
            }
        }).join('');
      }

      function createCalendar(containerId, venueFilter, { interactive = false, activeVenueId = null } = {}) {
        const calendarContainer = document.getElementById(containerId);
        if (!calendarContainer) return;
        
        calendarContainer.innerHTML = `
            <div class="crm-calendar-header">
                <button class="crm-calendar-nav-button" data-direction="prev">&lt;</button>
                <h2 class="crm-calendar-current"></h2>
                <button class="crm-calendar-nav-button" data-direction="next">&gt;</button>
            </div>
            <div class="crm-calendar-grid"></div>`;

        const currentMonthLabel = calendarContainer.querySelector('.crm-calendar-current');
        const calendarGrid = calendarContainer.querySelector('.crm-calendar-grid');
        const currentDate = new Date();
        currentDate.setDate(1);

        const updateGrid = () => {
            currentMonthLabel.textContent = currentDate.toLocaleString('ro-RO', { month: 'long', year: 'numeric' });
            calendarGrid.innerHTML = CALENDAR_DAY_NAMES.map(day => `<div class="crm-calendar-day-name">${day}</div>`).join('');
            
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) calendarGrid.insertAdjacentHTML('beforeend', '<div class="crm-calendar-date" data-outside="true"></div>');

            for (let day = 1; day <= daysInMonth; day++) {
                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dateEl = document.createElement('div');
                dateEl.className = 'crm-calendar-date';
                dateEl.dataset.date = dateString;
                dateEl.innerHTML = `<div class="crm-day-number">${day}</div>`;
                
                const allEvents = [ ...eventRequests, ...visitRequests.map(v => ({...v, eventType: "Vizită", status: v.status === 'pending' ? 'visit-pending' : v.status}))];
                const events = (venueFilter === 'all' ? allEvents : allEvents.filter(e => String(e.venueId) === String(venueFilter)))
                    .filter(e => e.date === dateString);
                
                events.forEach(event => {
                    dateEl.innerHTML += `<div class="crm-calendar-event" data-variant="${EVENT_STATUS_VARIANTS[event.status] || 'request'}">${event.eventType}</div>`;
                });
                
                const isBlocked = activeVenueId && availabilityData[activeVenueId]?.blockedDates.includes(dateString);
                if(isBlocked) {
                    dateEl.classList.add('is-unavailable');
                    dateEl.innerHTML += `<div class="crm-calendar-event" data-variant="unavailable">Indisponibil</div>`;
                }

                if (interactive && !events.length) {
                    dateEl.style.cursor = 'pointer';
                    dateEl.addEventListener('click', () => {
                        ensureVenueAvailability(activeVenueId);
                        const blocked = availabilityData[activeVenueId].blockedDates;
                        if(blocked.includes(dateString)) {
                            availabilityData[activeVenueId].blockedDates = blocked.filter(d => d !== dateString);
                        } else {
                            blocked.push(dateString);
                        }
                        updateGrid();
                    });
                }
                
                calendarGrid.appendChild(dateEl);
            }
        };

        calendarContainer.querySelector('[data-direction="prev"]').addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); updateGrid(); });
        calendarContainer.querySelector('[data-direction="next"]').addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); updateGrid(); });
        updateGrid();
      }

      function renderVisitScheduler() {
        if (!schedulerContainer) return;
        if (availabilitySelection === 'all') {
          schedulerContainer.innerHTML = '<p class="crm-scheduler-placeholder">Selectează o locație pentru a stabili intervalele.</p>';
          return;
        }

        ensureVenueAvailability(activeAvailabilityVenueId);
        const venueSlots = availabilityData[activeAvailabilityVenueId].visitSlots;
        schedulerContainer.innerHTML = WEEK_DAYS.map(day => {
            const slots = venueSlots[day] ?? [];
            return `
            <section class="crm-day-schedule" data-day="${day}">
              <h4>${day}</h4>
              <div class="crm-time-slots">${slots.map(slot => `<div class="crm-time-slot" data-start="${slot.start}" data-end="${slot.end}"><span>${slot.start} - ${slot.end}</span><button class="crm-remove-slot-btn">✕</button></div>`).join('')}</div>
              <form class="crm-add-slot-form">
                <input type="time" class="crm-start-time" required><input type="time" class="crm-end-time" required><button type="submit" class="crm-add-slot-btn">+</button>
              </form>
            </section>`;
        }).join('');
      }

      function updateAvailabilityPage() {
        const title = document.getElementById('availability-page-title');
        document.getElementById('availability-venue-selector').value = availabilitySelection === 'all' ? 'all' : String(activeAvailabilityVenueId);

        if (availabilitySelection === 'all') {
            title.textContent = 'Disponibilitate (Toate locațiile)';
            createCalendar('availability-calendar-container', 'all', { interactive: false });
            if (document.getElementById('availability').classList.contains('is-active')) {
                availabilityDialog?.classList.remove('is-hidden');
            }
        } else {
            const venue = venues.find(v => v.id === activeAvailabilityVenueId);
            title.textContent = `Disponibilitate: ${venue.name}`;
            createCalendar('availability-calendar-container', activeAvailabilityVenueId, { interactive: true, activeVenueId });
        }
        renderVisitScheduler();
      }
      
      function handleRequestAction(requestCollection, requestId, action) {
        const request = requestCollection.find(item => item.id === requestId);
        if (request) request.status = action === 'confirm' ? 'confirmed' : 'declined';
      }

      // --- Event Listeners ---
      document.addEventListener('click', (event) => {
        const navTrigger = event.target.closest('[data-crm-nav]');
        if (navTrigger) {
          event.preventDefault();
          const pageId = navTrigger.dataset.pageTarget;
          const venueId = navTrigger.dataset.venueId;
          if (pageId === 'availability' && venueId) {
            activeAvailabilityVenueId = parseInt(venueId, 10);
            availabilitySelection = String(activeAvailabilityVenueId);
          }
          showPage(pageId);
        }

        const actionButton = event.target.closest('.crm-action-button');
        if (actionButton) {
            const { action, requestType, requestId } = actionButton.dataset;
            const collection = requestType.includes('bookings') ? eventRequests : visitRequests;
            handleRequestAction(collection, parseInt(requestId), action);
            renderRequestsTable(requestType, collection, requestType.replace('table-body', 'venue-filter'));
            renderDashboardStats();
        }
      });
      
      schedulerContainer?.addEventListener('submit', event => {
        if (event.target.classList.contains('crm-add-slot-form')) {
          event.preventDefault();
          const form = event.target;
          const start = form.querySelector('.crm-start-time').value;
          const end = form.querySelector('.crm-end-time').value;
          if (!start || !end || start >= end || availabilitySelection === 'all') return;
          const day = form.closest('.crm-day-schedule').dataset.day;
          ensureVenueAvailability(activeAvailabilityVenueId);
          availabilityData[activeAvailabilityVenueId].visitSlots[day] = availabilityData[activeAvailabilityVenueId].visitSlots[day] || [];
          availabilityData[activeAvailabilityVenueId].visitSlots[day].push({ start, end });
          renderVisitScheduler();
        }
      });
      
      schedulerContainer?.addEventListener('click', event => {
        if (event.target.classList.contains('crm-remove-slot-btn')) {
            const slotEl = event.target.closest('.crm-time-slot');
            const day = event.target.closest('.crm-day-schedule').dataset.day;
            const { start, end } = slotEl.dataset;
            const slots = availabilityData[activeAvailabilityVenueId].visitSlots[day];
            availabilityData[activeAvailabilityVenueId].visitSlots[day] = slots.filter(s => s.start !== start || s.end !== end);
            renderVisitScheduler();
        }
      });
      
      availabilityDialogClose?.addEventListener('click', () => availabilityDialog?.classList.add('is-hidden'));
      availabilityDialog?.addEventListener('click', (e) => { if(e.target === availabilityDialog) availabilityDialog.classList.add('is-hidden'); });
      
      document.getElementById('bookings-venue-filter')?.addEventListener('change', () => renderRequestsTable('bookings-table-body', eventRequests, 'bookings-venue-filter'));
      document.getElementById('visits-venue-filter')?.addEventListener('change', () => renderRequestsTable('visits-table-body', visitRequests, 'visits-venue-filter'));
      document.getElementById('availability-venue-selector')?.addEventListener('change', (e) => {
        const { value } = e.target;
        availabilitySelection = value;
        if (value !== 'all') activeAvailabilityVenueId = parseInt(value, 10);
        updateAvailabilityPage();
      });

      // --- Initialization ---
      (function initialize() {
        populateVenueSelector('bookings-venue-filter', { includeAllOption: true });
        populateVenueSelector('visits-venue-filter', { includeAllOption: true });
        populateVenueSelector('availability-venue-selector', { includeAllOption: true });
        
        renderDashboardStats();
        renderVenuesPage();
        renderRequestsTable('bookings-table-body', eventRequests, 'bookings-venue-filter');
        renderRequestsTable('visits-table-body', visitRequests, 'visits-venue-filter');
        renderVisitsTrendChart();
        renderOccupancyChart();
        updateAvailabilityPage();
        
        const initialHash = window.location.hash.slice(1) || 'dashboard';
        const isValidHash = crmPages.some(p => p.id === initialHash);
        showPage(isValidHash ? initialHash : 'dashboard', { updateHash: false });
      })();
    }

    document.addEventListener('fragments:loaded', initOwnerCrmPage);
  </script>
</body>
</html>
